{"version":3,"sources":["shared/gameObjects/20_AbstractGameEntity.ts","shared/gameObjects/00_AbstractGameObject.ts","shared/gameObjects/controllers/ControllerManager.ts","shared/gameObjects/controllers/controllers/AbstractController.ts","shared/gameObjects/controllers/controllers/deserializers/ImmediateDeserializeController.ts","shared/gameObjects/controllers/controllers/deserializers/SmoothDeserializeController.ts","shared/gameObjects/controllers/controllers/input/KeyboardController.ts","shared/gameObjects/controllers/controllers/input/AbstractInputController.ts","shared/gameObjects/renderers/textures/texturePack.ts","shared/gameObjects/renderers/textures/SimpleTexture.ts","shared/gameObjects/renderers/textures/textureEngine.ts","shared/gameObjects/renderers/textures/AnimatedTexture.ts","shared/constants.ts","shared/gameObjects/renderers/00_AbstractRenderer.ts","shared/gameObjects/renderers/01_AbstractEntityRenderer.ts","shared/gameObjects/renderers/60_PlayerRenderer.ts","shared/gameObjects/60_Player.tsx","shared/colors.ts","shared/gameObjects/renderers/60_ChunkRenderer.ts","shared/gameObjects/10_Chunk.tsx","shared/utils/IndexedList.ts","shared/Scene.ts","frontend/keyBindings.ts","shared/gameObjects/renderers/11_StaticRenderer.ts","shared/gameObjects/60_Tree.tsx","shared/gameObjects/60_Stone.tsx","shared/gameObjects/controllers/controllers/ai/ChickenAIController.ts","shared/gameObjects/renderers/10_SimpleRenderer.ts","shared/gameObjects/60_Chicken.tsx","frontend/gameMechanics/network/Client.ts","frontend/gameMechanics/utils/shadeText.ts","frontend/gameMechanics/GameCore.tsx","frontend/gameMechanics/gui/minimap.ts","frontend/gameMechanics/gui/debugInfo.ts","frontend/App.tsx","serviceWorker.js","index.tsx"],"names":["Platform","AbstractGameObject","gameScene","renderer","position","Vector2","Zero","visibility","babylonScene","this","attached","detach","update","deltaTime","visible","AbstractGameEntity","id","disabled","hitbox","width","height","velocity","controllerManager","dirtyListeners","updatedAt","x","y","velocityX","velocityY","type","data","serialized","timestamp","deserialize","setDirty","invoke","listener","push","forEach","attachRenderer","entity","ControllerManager","controllers","controller","filter","fn","args","c","AbstractController","object","ImmediateDeserializeController","SmoothDeserializeController","targetX","targetY","finalVelocityX","finalVelocityY","targetTime","smoothTime","time","KeyboardMotionController","keyBindings","up","down","left","right","deltaTimeModified","movingX","movingY","diagonalModifier","Math","sqrt","keysPressed","includes","ogX","ogY","pow","abs","colisions","getColisions","length","colisionX","colisionY","colisionFromBottom","colisionFromLeft","colisionFromTop","colisionFromRight","newBindings","mousePressed","keyCode","key","textures","player","filename","animations","default","start","end","walking","inventory_opening","inventory_open","inventory_closing","equip","unequip","mine","eat","interact","chicken","rock_big","rock_small","bush","tree_small","tree_big","tree_short","tree_tall","grass_water_L","grass_water_R","grass_water_T","grass_water_B","grass_water_TL","grass_water_RB","grass_water_TR","grass_water_BL","grass_water_TBL","grass_water_TRL","grass_water_RBL","grass_water_TRB","grass_water_TRBL","grass_water_corner_BL","grass_water_corner_BR","grass_water_corner_TL","grass_water_corner_TR","SimpleTexture","textureAtlas","scene","texture","Error","t","Texture","RESOURCES_LOCATION","NEAREST_NEAREST","hasAlpha","removeTexture","resourceFiles","Object","values","map","v","i","indexOf","atlases","materials","loaded","getSimpleMaterial","material","createMaterial","getTexture","noAlpha","StandardMaterial","diffuseTexture","opacityTexture","specularColor","BABYLON","Color3","getImage","console","warn","AnimatedTexture","animation","animationQueue","frame","direction","interval","textureScale","uOffset","vOffset","uScale","vScale","queue","setInterval","tick","unskipable","isLast","keys","skippable","framesCount","haveNextAnimation","shift","newAnimation","animationDir","error","CAMERA_ANGLE","PI","AbstractRenderer","mesh","removeMesh","AbstractEntityRenderer","z","getSize","cos","rotation","sin","isPickable","PlayerRenderer","titleTexture","size","MeshBuilder","CreatePlane","sideOrientation","Mesh","FRONTSIDE","title","Vector3","DynamicTexture","LINEAR_LINEAR","parent","ctx","getContext","clearRect","fillStyle","fillRect","font","textBaseline","textAlign","fillText","name","queueOnce","child","getChildMeshes","removeMaterial","Player","sup","platform","me","Server","attach","Client","getTerrainColor","number","ChunkRenderer","drawTexture","drawBasicTiling","ground","drawTransition","tileType","filePrefix","posX","posY","sides","getTile","top","drawImage","bottom","img","corner","shiftX","shiftY","blackList","suffix","reduce","prev","letter","chunk","Chunk","entities","Set","hasEntity","has","add","delete","getId","toString","IndexedList","value","detachRenderer","newObjectCreator","callbackfn","index","result","getKeys","GameScene","chunks","timeStart","Date","getTime","updateEntity","calcX","floor","calcY","chunkX","chunkY","get","colidesWith","closest","e","getValues","sort","a","b","distance","day","hour","min","sec","CONTROLS_WASD","StaticRenderer","getMaterial","Tree","Stone","ChickenAIController","angle","closestPlayer","getClosestEntityOfType","inLove","rotate","atan2","random","SimpleRenderer","Chicken","NetworkClient","apiUrl","getBabylonScene","updateSocket","largeDataSocket","userId","callbacks","authenticated","updated","invalidPassword","disconnect","token","event","callback","io","setServiceListeners","on","_data","log","setMainListeners","emit","socket","removed","remove","updateOrCreate","createEntity","enableGameListeners","payload","serialize","loadedChunks","ch","getVisibility","password","passwordHash","md5","deserializeImmediatelly","attachControllers","attachDirtyListener","shadeText","text","strokeStyle","lineWidth","strokeText","GameCore","props","guiTexture","networkClient","state","loggedIn","timer","zoom","renderDistance","debug","loginRef","createRef","passwordRef","mouseEntity","initGame","current","classList","setTimeout","document","addEventListener","deltaY","window","resize","open","clearInterval","close","setState","enableDebug","debugLayer","show","sendPlayerUpdate","unloadUnusedComponents","requestChunks","gui","x0","MINIMAP_SCALE","y0","MINIMAP_DISTANCE","getEntityColor","strokeRect","round","padStart","minimap","FPS","toFixed","debugInfo","canvas","getElementById","innerWidth","innerHeight","camera","UniversalCamera","skybox","CreateCylinder","CAMERA_DISTANCE","diameterTop","MAX_RENDER_DISTANCE","diameterBottom","tessellation","nightLight","DirectionalLight","diffuse","dayLight","skyboxMaterial","backFaceCulling","diffuseColor","disableLighting","AdvancedDynamicTexture","CreateFullscreenUI","onPointerDown","pickResult","hit","pickedMesh","startsWith","split","button","onPointerUp","getEngine","runRenderLoop","getDeltaTime","tan","intensity","change","ceil","render","distX","distY","setVisibility","setVisibilityAttachRenderer","chunkId","requestChunk","className","placeholder","ref","onClick","auth","antialias","canvasId","onSceneMount","React","Component","App","status","of","location","host","onLoad","onStateChange","Image","onload","onerror","src","Boolean","hostname","match","ReactDOM","StrictMode","navigator","serviceWorker","ready","then","registration","unregister","catch","message"],"mappings":"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","file":"static/js/main.92db136b.chunk.js","sourcesContent":["import { Scene, Vector2 } from 'babylonjs';\r\nimport { GameScene } from '../Scene';\r\nimport { AbstractGameObject } from './00_AbstractGameObject';\r\nimport { ControllerManager } from './controllers/ControllerManager';\r\n\r\nexport interface serializedEntity<T> {\r\n    id: string;\r\n    x: number;\r\n    y: number;\r\n    velocityX: number;\r\n    velocityY: number;\r\n    type: string;\r\n    data: T;\r\n}\r\n\r\nexport enum Platform {\r\n    Server = 'SERVER',\r\n    Client = 'CLIENT',\r\n}\r\n\r\nexport abstract class AbstractGameEntity extends AbstractGameObject {\r\n    // Should be used for all entities, buildings, trees, etc.\r\n\r\n    public disabled: boolean = false;\r\n    public hitbox: { width: number; height: number } = { width: 0, height: 0 };\r\n    public velocity: Vector2 = Vector2.Zero();\r\n\r\n    public controllerManager: ControllerManager;\r\n\r\n    private dirtyListeners: ((entity: AbstractGameEntity) => void)[] = [];\r\n\r\n    public updatedAt: number = 0;\r\n\r\n    constructor(public gameScene: GameScene, public id: string) {\r\n        super(gameScene);\r\n    }\r\n\r\n    serialize(): serializedEntity<{}> {\r\n        return {\r\n            id: this.id,\r\n            x: this.position.x,\r\n            y: this.position.y,\r\n            velocityX: this.velocity.x,\r\n            velocityY: this.velocity.y,\r\n            type: AbstractGameEntity.type,\r\n            data: {},\r\n        };\r\n    }\r\n\r\n    deserializeImmediatelly(serialized: any, timestamp: number): void {\r\n        this.position.x = serialized.x;\r\n        this.position.y = serialized.y;\r\n        this.velocity.x = serialized.velocityX;\r\n        this.velocity.y = serialized.velocityY;\r\n        this.deserialize(serialized, timestamp);\r\n        this.update();\r\n        this.setDirty();\r\n    }\r\n\r\n    deserialize(serialized: any, timestamp: number): void {\r\n        this.controllerManager.invoke('deserialize', serialized);\r\n        this.updatedAt = timestamp;\r\n        this.update();\r\n        this.setDirty();\r\n    }\r\n\r\n    abstract attachControllers(platform: Platform): void;\r\n\r\n    attachDirtyListener(listener: (entity: AbstractGameEntity) => void) {\r\n        this.dirtyListeners.push(listener);\r\n    }\r\n\r\n    public setDirty() {\r\n        this.dirtyListeners.forEach((listener) => listener(this));\r\n    }\r\n\r\n    abstract getSize(): Vector2;\r\n\r\n    static get type(): string {\r\n        return 'unknown';\r\n    }\r\n\r\n    public async setVisibilityAttachRenderer(visible: boolean, babylonScene: Scene) {\r\n        super.setVisibility(visible);\r\n        if (visible && !this.renderer) this.attachRenderer(babylonScene);\r\n    }\r\n\r\n    public colidesWith(entity: AbstractGameEntity) {\r\n        return (\r\n            this.position.x - this.hitbox.width < entity.position.x + entity.hitbox.width &&\r\n            this.position.x + this.hitbox.width > entity.position.x - entity.hitbox.width &&\r\n            this.position.y - this.hitbox.height < entity.position.y + entity.hitbox.height &&\r\n            this.position.y + this.hitbox.height > entity.position.y - entity.hitbox.height\r\n        );\r\n    }\r\n\r\n    tick(deltaTime: number): void {\r\n        this.controllerManager.invoke('tick', deltaTime);\r\n    }\r\n}\r\n","import { Vector2, Scene } from 'babylonjs';\r\nimport { GameScene } from '../Scene';\r\nimport { AbstractRenderer } from './renderers/00_AbstractRenderer';\r\n\r\nexport abstract class AbstractGameObject {\r\n    protected renderer: AbstractRenderer | null = null;\r\n    public position: Vector2 = Vector2.Zero();\r\n    protected visibility: boolean = true;\r\n\r\n    constructor(public gameScene: GameScene) {}\r\n\r\n    abstract serialize(): any;\r\n\r\n    abstract deserialize(serialized: any, timestamp: number): void;\r\n\r\n    async attachRenderer(babylonScene: Scene) {\r\n        if (this.renderer && this.renderer.attached) {\r\n            this.renderer.detach();\r\n        }\r\n    }\r\n\r\n    async detachRenderer(): Promise<void> {\r\n        if (this.renderer) this.renderer.detach();\r\n    }\r\n\r\n    protected update() {\r\n        if (this.renderer) {\r\n            this.renderer.update();\r\n        }\r\n    }\r\n\r\n    tick(deltaTime: number): void {}\r\n\r\n    setVisibility(visible: boolean) {\r\n        this.visibility = visible;\r\n        if (this.renderer) this.renderer.update();\r\n    }\r\n\r\n    getVisibility() {\r\n        return this.visibility;\r\n    }\r\n\r\n    abstract get id(): string;\r\n}\r\n","import { AbstractController } from './controllers/AbstractController';\r\n\r\nexport class ControllerManager {\r\n    constructor(private controllers: AbstractController[] = []) {}\r\n\r\n    public attach(controller: AbstractController) {\r\n        this.controllers.push(controller);\r\n    }\r\n\r\n    public detach(filter: (controller: AbstractController) => boolean) {\r\n        this.controllers = this.controllers.filter(filter);\r\n    }\r\n\r\n    public invoke(fn: string, ...args: any[]) {\r\n        this.controllers.forEach((c) => (c as any)[fn] && (c as any)[fn](...args));\r\n    }\r\n}\r\n","import { AbstractGameObject } from '../../00_AbstractGameObject';\r\nimport { serializedEntity } from '../../20_AbstractGameEntity';\r\n\r\nexport abstract class AbstractController {\r\n    constructor(protected object: AbstractGameObject) {}\r\n\r\n    public tick(deltaTime: number) {}\r\n    public deserialize(serialized: serializedEntity<any>) {}\r\n}\r\n","import { AbstractGameEntity, serializedEntity } from '../../../20_AbstractGameEntity';\r\nimport { AbstractController } from '../AbstractController';\r\n\r\nexport class ImmediateDeserializeController extends AbstractController {\r\n    constructor(protected object: AbstractGameEntity) {\r\n        super(object);\r\n    }\r\n\r\n    public deserialize(serialized: serializedEntity<any>) {\r\n        this.object.position.x = serialized.x;\r\n        this.object.position.y = serialized.y;\r\n        this.object.velocity.x = serialized.velocityX;\r\n        this.object.velocity.y = serialized.velocityY;\r\n    }\r\n}\r\n","import { AbstractGameEntity, serializedEntity } from '../../../20_AbstractGameEntity';\r\nimport { AbstractController } from '../AbstractController';\r\n\r\nconst SMOOTH_TIME_DEFAULT = 110;\r\n\r\nexport class SmoothDeserializeController extends AbstractController {\r\n    private targetX: number = 0;\r\n    private targetY: number = 0;\r\n    private finalVelocityX: number = 0;\r\n    private finalVelocityY: number = 0;\r\n    private targetTime: number = -1;\r\n\r\n    private smoothTime: number = SMOOTH_TIME_DEFAULT;\r\n\r\n    constructor(protected object: AbstractGameEntity) {\r\n        super(object);\r\n    }\r\n\r\n    public tick(deltaTime: number) {\r\n        if (this.targetTime > 0) {\r\n            this.object.position.x += this.object.velocity.x * deltaTime;\r\n            this.object.position.y += this.object.velocity.y * deltaTime;\r\n            this.targetTime -= deltaTime;\r\n\r\n            if (this.targetTime <= 0) {\r\n                this.object.position.x = this.targetX;\r\n                this.object.position.y = this.targetY;\r\n                this.object.velocity.x = this.finalVelocityX;\r\n                this.object.velocity.y = this.finalVelocityY;\r\n            }\r\n            return;\r\n        } else {\r\n            super.tick(deltaTime);\r\n        }\r\n    }\r\n\r\n    public setSmoothTime(time: number) {\r\n        this.smoothTime = time;\r\n    }\r\n\r\n    public deserialize(serialized: serializedEntity<any>) {\r\n        this.targetX = serialized.x;\r\n        this.targetY = serialized.y;\r\n\r\n        this.finalVelocityX = serialized.velocityX;\r\n        this.finalVelocityY = serialized.velocityY;\r\n        this.targetTime = this.smoothTime;\r\n        this.object.velocity.x = (serialized.x - this.object.position.x) / this.smoothTime;\r\n        this.object.velocity.y = (serialized.y - this.object.position.y) / this.smoothTime;\r\n    }\r\n}\r\n","import { AbstractGameEntity } from '../../../20_AbstractGameEntity';\r\nimport { AbstractInputController } from './AbstractInputController';\r\n\r\nexport interface keyBindings {\r\n    up: number;\r\n    down: number;\r\n    left: number;\r\n    right: number;\r\n}\r\n\r\nconst SPEED_CHANGE = 0.002;\r\nconst SLOWING = 0.95;\r\nconst MODIFIER = 0.1;\r\n\r\nexport class KeyboardMotionController extends AbstractInputController {\r\n    private keyBindings: keyBindings = {\r\n        up: 0,\r\n        down: 0,\r\n        left: 0,\r\n        right: 0,\r\n    };\r\n\r\n    constructor(protected object: AbstractGameEntity) {\r\n        super(object);\r\n    }\r\n\r\n    tick(deltaTime: number) {\r\n        const deltaTimeModified = MODIFIER * deltaTime;\r\n\r\n        let movingX = false;\r\n        let movingY = false;\r\n\r\n        const diagonalModifier = Math.sqrt(2);\r\n\r\n        if (this.keysPressed.includes(this.keyBindings.left) || this.keysPressed.includes(this.keyBindings.right)) {\r\n            movingX = true;\r\n        }\r\n        if (this.keysPressed.includes(this.keyBindings.up) || this.keysPressed.includes(this.keyBindings.down)) {\r\n            movingY = true;\r\n        }\r\n\r\n        if (this.keysPressed.includes(this.keyBindings.left)) {\r\n            // Left\r\n            this.object.velocity.x -= (SPEED_CHANGE * deltaTimeModified) / (movingY ? diagonalModifier : 1);\r\n        }\r\n        if (this.keysPressed.includes(this.keyBindings.right)) {\r\n            // Right\r\n            this.object.velocity.x += (SPEED_CHANGE * deltaTimeModified) / (movingY ? diagonalModifier : 1);\r\n        }\r\n        if (this.keysPressed.includes(this.keyBindings.up)) {\r\n            // Up\r\n            this.object.velocity.y -= (SPEED_CHANGE * deltaTimeModified) / (movingX ? diagonalModifier : 1);\r\n        }\r\n        if (this.keysPressed.includes(this.keyBindings.down)) {\r\n            // Down\r\n            this.object.velocity.y += (SPEED_CHANGE * deltaTimeModified) / (movingX ? diagonalModifier : 1);\r\n        }\r\n\r\n        const ogX = this.object.position.x;\r\n        const ogY = this.object.position.y;\r\n\r\n        this.object.position.x += this.object.velocity.x * deltaTimeModified;\r\n        this.object.position.y += this.object.velocity.y * deltaTimeModified;\r\n\r\n        this.object.velocity.x *= Math.pow(SLOWING, deltaTimeModified);\r\n        this.object.velocity.y *= Math.pow(SLOWING, deltaTimeModified);\r\n\r\n        if (Math.abs(this.object.velocity.x) < 0.001) {\r\n            this.object.velocity.x = 0;\r\n        }\r\n        if (Math.abs(this.object.velocity.y) < 0.001) {\r\n            this.object.velocity.y = 0;\r\n        }\r\n\r\n        // Colisions\r\n        const colisions = this.object.gameScene.getColisions(this.object);\r\n        if (colisions.length() > 0) {\r\n            let colisionX = false;\r\n            let colisionY = false;\r\n\r\n            colisions.forEach((entity) => {\r\n                let colisionFromBottom =\r\n                    !(ogY - this.object.hitbox.height < entity.position.y + entity.hitbox.height) &&\r\n                    this.object.position.y - this.object.hitbox.height < entity.position.y + entity.hitbox.height;\r\n\r\n                let colisionFromLeft =\r\n                    !(ogX + this.object.hitbox.width > entity.position.x - entity.hitbox.width) &&\r\n                    this.object.position.x + this.object.hitbox.width > entity.position.x - entity.hitbox.width;\r\n\r\n                let colisionFromTop =\r\n                    !(ogY + this.object.hitbox.height > entity.position.y - entity.hitbox.height) &&\r\n                    this.object.position.y + this.object.hitbox.height > entity.position.y - entity.hitbox.height;\r\n\r\n                let colisionFromRight =\r\n                    !(ogX - this.object.hitbox.width < entity.position.x + entity.hitbox.width) &&\r\n                    this.object.position.x - this.object.hitbox.width < entity.position.x + entity.hitbox.width;\r\n\r\n                colisionX = colisionX || colisionFromLeft || colisionFromRight;\r\n                colisionY = colisionY || colisionFromBottom || colisionFromTop;\r\n            });\r\n\r\n            if (colisionX) {\r\n                this.object.position.x = ogX;\r\n                this.object.velocity.x = 0;\r\n            }\r\n            if (colisionY) {\r\n                this.object.position.y = ogY;\r\n                this.object.velocity.y = 0;\r\n            }\r\n        }\r\n\r\n        this.object.setDirty();\r\n    }\r\n\r\n    public bindKeys(newBindings: Partial<keyBindings>) {\r\n        this.keyBindings = { ...this.keyBindings, ...newBindings };\r\n    }\r\n}\r\n","import { AbstractController } from '../AbstractController';\r\n\r\nexport abstract class AbstractInputController extends AbstractController {\r\n    protected keysPressed: number[] = [];\r\n    protected mousePressed: number[] = [];\r\n\r\n    public keyDown(keyCode: number) {\r\n        if (!this.keysPressed.includes(keyCode)) {\r\n            this.keysPressed.push(keyCode);\r\n        }\r\n    }\r\n\r\n    public keyUp(keyCode: number) {\r\n        if (this.keysPressed.includes(keyCode)) {\r\n            this.keysPressed = this.keysPressed.filter((key) => key !== keyCode);\r\n        }\r\n    }\r\n\r\n    public mouseDown(keyCode: number) {\r\n        if (!this.mousePressed.includes(keyCode)) {\r\n            this.mousePressed.push(keyCode);\r\n        }\r\n    }\r\n\r\n    public mouseUp(keyCode: number) {\r\n        if (this.mousePressed.includes(keyCode)) {\r\n            this.mousePressed = this.mousePressed.filter((key) => key !== keyCode);\r\n        }\r\n    }\r\n}\r\n","import { texturePack } from './textureEngine';\r\n\r\nexport const textures: texturePack = {\r\n    player: {\r\n        filename: 'Character.png',\r\n        width: 57,\r\n        animations: {\r\n            default: {\r\n                start: 0,\r\n                end: 0,\r\n                type: 'frame',\r\n            },\r\n            walking: {\r\n                start: 0,\r\n                end: 7,\r\n                type: 'loop',\r\n            },\r\n            inventory_opening: {\r\n                start: 8,\r\n                end: 11,\r\n                type: 'once',\r\n            },\r\n            inventory_open: {\r\n                start: 11,\r\n                end: 11,\r\n                type: 'frame',\r\n            },\r\n            inventory_closing: {\r\n                start: 11,\r\n                end: 8,\r\n                type: 'once',\r\n            },\r\n            equip: {\r\n                start: 12,\r\n                end: 19,\r\n                type: 'once',\r\n            },\r\n            unequip: {\r\n                start: 19,\r\n                end: 12,\r\n                type: 'once',\r\n            },\r\n            mine: {\r\n                start: 20,\r\n                end: 22,\r\n                type: 'boomerang',\r\n            },\r\n            eat: {\r\n                start: 23,\r\n                end: 51,\r\n                type: 'once',\r\n            },\r\n            interact: {\r\n                start: 52,\r\n                end: 56,\r\n                type: 'once',\r\n            },\r\n        },\r\n    },\r\n    chicken: {\r\n        filename: 'chicken.png',\r\n        width: 1,\r\n        animations: {},\r\n    },\r\n    rock_big: {\r\n        filename: 'rock_big.png',\r\n        width: 1,\r\n        animations: {},\r\n    },\r\n    rock_small: {\r\n        filename: 'rock_small.png',\r\n        width: 1,\r\n        animations: {},\r\n    },\r\n    bush: {\r\n        filename: 'bush.png',\r\n        width: 1,\r\n        animations: {},\r\n    },\r\n    tree_small: {\r\n        filename: 'tree_small.png',\r\n        width: 1,\r\n        animations: {},\r\n    },\r\n    tree_big: {\r\n        filename: 'tree_big.png',\r\n        width: 1,\r\n        animations: {},\r\n    },\r\n    tree_short: {\r\n        filename: 'tree_short.png',\r\n        width: 1,\r\n        animations: {},\r\n    },\r\n    tree_tall: {\r\n        filename: 'tree_tall.png',\r\n        width: 1,\r\n        animations: {},\r\n    },\r\n    grass_water_L: {\r\n        filename: 'grass_water_L.png',\r\n        width: 1,\r\n        animations: {},\r\n    },\r\n    grass_water_R: {\r\n        filename: 'grass_water_R.png',\r\n        width: 1,\r\n        animations: {},\r\n    },\r\n    grass_water_T: {\r\n        filename: 'grass_water_T.png',\r\n        width: 1,\r\n        animations: {},\r\n    },\r\n    grass_water_B: {\r\n        filename: 'grass_water_B.png',\r\n        width: 1,\r\n        animations: {},\r\n    },\r\n    grass_water_TL: {\r\n        filename: 'grass_water_TL.png',\r\n        width: 1,\r\n        animations: {},\r\n    },\r\n    grass_water_RB: {\r\n        filename: 'grass_water_RB.png',\r\n        width: 1,\r\n        animations: {},\r\n    },\r\n    grass_water_TR: {\r\n        filename: 'grass_water_TR.png',\r\n        width: 1,\r\n        animations: {},\r\n    },\r\n    grass_water_BL: {\r\n        filename: 'grass_water_BL.png',\r\n        width: 1,\r\n        animations: {},\r\n    },\r\n    grass_water_TBL: {\r\n        filename: 'grass_water_TBL.png',\r\n        width: 1,\r\n        animations: {},\r\n    },\r\n    grass_water_TRL: {\r\n        filename: 'grass_water_TRL.png',\r\n        width: 1,\r\n        animations: {},\r\n    },\r\n    grass_water_RBL: {\r\n        filename: 'grass_water_RBL.png',\r\n        width: 1,\r\n        animations: {},\r\n    },\r\n    grass_water_TRB: {\r\n        filename: 'grass_water_TRB.png',\r\n        width: 1,\r\n        animations: {},\r\n    },\r\n    grass_water_TRBL: {\r\n        filename: 'grass_water_TRBL.png',\r\n        width: 1,\r\n        animations: {},\r\n    },\r\n    grass_water_corner_BL: {\r\n        filename: 'grass_water_corner_BL.png',\r\n        width: 1,\r\n        animations: {},\r\n    },\r\n    grass_water_corner_BR: {\r\n        filename: 'grass_water_corner_BR.png',\r\n        width: 1,\r\n        animations: {},\r\n    },\r\n    grass_water_corner_TL: {\r\n        filename: 'grass_water_corner_TL.png',\r\n        width: 1,\r\n        animations: {},\r\n    },\r\n    grass_water_corner_TR: {\r\n        filename: 'grass_water_corner_TR.png',\r\n        width: 1,\r\n        animations: {},\r\n    },\r\n};\r\n","import { Texture, Scene } from 'babylonjs';\r\nimport { textures } from './texturePack';\r\nimport { RESOURCES_LOCATION } from './textureEngine';\r\n\r\nexport class SimpleTexture {\r\n    private texture: Texture;\r\n    constructor(textureAtlas: string, private scene: Scene) {\r\n        if (!textures[textureAtlas]) {\r\n            throw new Error(\"Texture atlas '\" + textureAtlas + \"' is not defined\");\r\n        }\r\n\r\n        const t = new Texture(\r\n            RESOURCES_LOCATION + textures[textureAtlas].filename,\r\n            scene,\r\n            false,\r\n            true,\r\n            Texture.NEAREST_NEAREST,\r\n        );\r\n        t.hasAlpha = true;\r\n        this.texture = t;\r\n    }\r\n\r\n    getTexture() {\r\n        return this.texture;\r\n    }\r\n\r\n    detach() {\r\n        this.scene.removeTexture(this.texture);\r\n    }\r\n}\r\n","import { Texture, Scene, StandardMaterial, Material } from 'babylonjs';\r\nimport { SimpleTexture } from './SimpleTexture';\r\nimport { textures } from './texturePack';\r\n\r\nexport interface texturePack {\r\n    [name: string]: {\r\n        filename: string;\r\n        width: number;\r\n        animations: { [name: string]: { start: number; end: number; type: 'loop' | 'once' | 'boomerang' | 'frame' } };\r\n    };\r\n}\r\n\r\nlet resourceFiles = Object.values(textures).map((texture) => texture.filename);\r\nresourceFiles = resourceFiles.filter((v, i) => resourceFiles.indexOf(v) === i);\r\n\r\nlet atlases: { [key: string]: HTMLImageElement } = {};\r\nlet materials: { [key: string]: Material } = {};\r\n\r\nlet loaded = 0;\r\n\r\nexport const RESOURCES_LOCATION = '/randomgame/resources/textures/';\r\n\r\nexport function loadTextures(onLoad: () => void, onStateChange?: (loaded: number, of: number) => void) {\r\n    if (resourceFiles.length === 0) {\r\n        onStateChange && onStateChange(0, resourceFiles.length);\r\n        onLoad();\r\n    }\r\n\r\n    resourceFiles.forEach((filename) => {\r\n        atlases[filename] = new Image();\r\n        atlases[filename].onload = () => {\r\n            loaded++;\r\n            onStateChange && onStateChange(loaded, resourceFiles.length);\r\n\r\n            if (loaded === resourceFiles.length) {\r\n                onLoad();\r\n            }\r\n        };\r\n        atlases[filename].onerror = () => {\r\n            console.error('Error loading resource file: ', filename);\r\n        };\r\n        atlases[filename].src = RESOURCES_LOCATION + filename;\r\n    });\r\n\r\n    return resourceFiles.length;\r\n}\r\n\r\nexport function createTexture(texture: string, scene: Scene) {\r\n    const t = new Texture(\r\n        RESOURCES_LOCATION + textures[texture].filename,\r\n        scene,\r\n        false,\r\n        true,\r\n        Texture.NEAREST_SAMPLINGMODE,\r\n    );\r\n    t.uOffset = 0;\r\n    t.vOffset = 0;\r\n    t.uScale = 1 / textures[texture].width;\r\n    t.vScale = 1;\r\n    t.hasAlpha = true;\r\n    return t;\r\n}\r\n\r\nexport function getSimpleMaterial(textureAtlas: string, scene: Scene) {\r\n    if (materials[textureAtlas]) {\r\n        return materials[textureAtlas];\r\n    }\r\n\r\n    const texture = new SimpleTexture(textureAtlas, scene);\r\n    const material = createMaterial(texture.getTexture(), scene);\r\n    materials[textureAtlas] = material;\r\n\r\n    return material;\r\n}\r\n\r\nexport function createMaterial(texture: Texture, scene: Scene, noAlpha?: true) {\r\n    const material = new StandardMaterial('mat', scene);\r\n    // Emissive:\r\n    //material.emissiveTexture = texture;\r\n    //if (!noAlpha) material.opacityTexture = texture;\r\n\r\n    // Diffusive:\r\n    material.diffuseTexture = texture;\r\n    if (!noAlpha) material.opacityTexture = texture;\r\n    material.specularColor = new BABYLON.Color3(0, 0, 0);\r\n\r\n    return material;\r\n}\r\n\r\nexport function getImage(texture: string): HTMLImageElement | null {\r\n    if (!textures[texture]) {\r\n        console.warn('Image ' + texture + ' not found!');\r\n        return null;\r\n    }\r\n    return atlases[textures[texture].filename];\r\n}\r\n","import { Texture, Scene } from 'babylonjs';\r\nimport { textures } from './texturePack';\r\nimport { RESOURCES_LOCATION } from './textureEngine';\r\n\r\nconst TIME_PER_FRAME = 80;\r\n\r\nexport class AnimatedTexture {\r\n    private textureAtlas: string;\r\n    private texture: Texture;\r\n    private animationQueue: { texture: string; skippable: boolean }[] = [];\r\n    private frame: number = 0;\r\n    private direction: number = 1;\r\n    private interval: NodeJS.Timeout;\r\n\r\n    private textureScale = 1;\r\n\r\n    constructor(textureAtlas: string, private scene: Scene, animation: string = 'default') {\r\n        this.textureAtlas = textureAtlas;\r\n        this.textureScale = 1 / textures[textureAtlas].width;\r\n\r\n        const t = new Texture(\r\n            RESOURCES_LOCATION + textures[textureAtlas].filename,\r\n            scene,\r\n            false,\r\n            true,\r\n            Texture.NEAREST_NEAREST,\r\n        );\r\n        t.uOffset = this.textureScale * textures[textureAtlas].animations[animation].start;\r\n        t.vOffset = 0;\r\n        t.uScale = this.textureScale;\r\n        t.vScale = 1;\r\n        t.hasAlpha = true;\r\n\r\n        this.texture = t;\r\n\r\n        this.queue(animation);\r\n        this.interval = setInterval(() => this.tick(), TIME_PER_FRAME);\r\n    }\r\n\r\n    getTexture() {\r\n        return this.texture;\r\n    }\r\n\r\n    isLast(animation: string) {\r\n        return this.animationQueue[this.animationQueue.length - 1].texture === animation;\r\n    }\r\n\r\n    queueOnce(animation: string, unskipable?: boolean) {\r\n        if (!this.isLast(animation)) {\r\n            this.queue(animation, unskipable);\r\n        }\r\n    }\r\n\r\n    queue(animation: string, unskipable?: boolean) {\r\n        if (!Object.keys(textures[this.textureAtlas].animations).includes(animation)) {\r\n            console.warn('Animation does not exist');\r\n            this.animationQueue.push({ texture: 'default', skippable: true });\r\n            return;\r\n        }\r\n\r\n        if (this.animationQueue.length > 1 && this.animationQueue[this.animationQueue.length - 1].skippable) {\r\n            this.animationQueue[this.animationQueue.length - 1] = { texture: animation, skippable: !unskipable };\r\n        } else {\r\n            this.animationQueue.push({ texture: animation, skippable: !unskipable });\r\n        }\r\n    }\r\n\r\n    tick() {\r\n        if (!this.texture) {\r\n            console.error('Texture is null');\r\n            return;\r\n        }\r\n\r\n        this.frame += this.direction;\r\n\r\n        const animation = textures[this.textureAtlas].animations[this.animationQueue[0].texture];\r\n        const framesCount = Math.abs(animation.start - animation.end);\r\n\r\n        const haveNextAnimation = this.animationQueue.length > 1;\r\n\r\n        if (this.frame > framesCount) {\r\n            // At the right end\r\n\r\n            switch (animation.type) {\r\n                case 'loop':\r\n                    this.direction = 1;\r\n                    this.frame = 0;\r\n                    if (haveNextAnimation) {\r\n                        this.animationQueue.shift();\r\n                    }\r\n                    break;\r\n                case 'once':\r\n                    this.direction = 1;\r\n                    if (haveNextAnimation) {\r\n                        this.frame = 0;\r\n                        this.animationQueue.shift();\r\n                    } else {\r\n                        this.frame = framesCount;\r\n                    }\r\n                    break;\r\n                case 'boomerang':\r\n                    this.direction = -1;\r\n                    this.frame -= 2;\r\n                    break;\r\n                case 'frame':\r\n                    this.direction = 1;\r\n                    this.frame = 0;\r\n                    if (haveNextAnimation) {\r\n                        this.animationQueue.shift();\r\n                    }\r\n                    break;\r\n            }\r\n        }\r\n\r\n        if (this.frame < 0) {\r\n            // At the left end - Can happen just with boomerang\r\n            this.direction = 1;\r\n            if (haveNextAnimation) {\r\n                this.frame = 0;\r\n                this.animationQueue.shift();\r\n            } else {\r\n                this.frame = 0;\r\n            }\r\n        }\r\n\r\n        const newAnimation = textures[this.textureAtlas].animations[this.animationQueue[0].texture];\r\n        const animationDir = newAnimation.start > newAnimation.end ? -1 : 1;\r\n        this.texture.uOffset = (this.frame * animationDir + newAnimation.start) * this.textureScale;\r\n    }\r\n\r\n    detach() {\r\n        this.scene.removeTexture(this.texture);\r\n    }\r\n}\r\n","export const CAMERA_DISTANCE = 1500;\r\nexport const CAMERA_ANGLE = Math.PI / 4;\r\n","import { Mesh } from 'babylonjs/Meshes/mesh';\r\nimport { Scene } from 'babylonjs/scene';\r\nimport { AbstractGameObject } from '../00_AbstractGameObject';\r\n\r\nexport abstract class AbstractRenderer {\r\n    public attached: boolean = true;\r\n    protected mesh: Mesh;\r\n\r\n    constructor(protected object: AbstractGameObject, protected babylonScene: Scene) {}\r\n\r\n    abstract async update(): Promise<void>;\r\n\r\n    detach() {\r\n        if (!this.attached) return;\r\n\r\n        this.babylonScene.removeMesh(this.mesh, true);\r\n        this.attached = false;\r\n    }\r\n}\r\n","import { Scene } from 'babylonjs/scene';\r\nimport { CAMERA_ANGLE } from '../../constants';\r\nimport { AbstractGameEntity } from '../20_AbstractGameEntity';\r\nimport { AbstractRenderer } from './00_AbstractRenderer';\r\n\r\nexport abstract class AbstractEntityRenderer extends AbstractRenderer {\r\n    constructor(protected object: AbstractGameEntity, protected babylonScene: Scene) {\r\n        super(object, babylonScene);\r\n    }\r\n\r\n    async update() {\r\n        if (this.mesh) {\r\n            this.mesh.position.z = -(this.object.getSize().y * Math.cos(CAMERA_ANGLE)) / 2;\r\n            this.mesh.rotation.x = -CAMERA_ANGLE;\r\n\r\n            this.mesh.position.x = this.object.position.x * 100;\r\n            this.mesh.position.y =\r\n                -this.object.position.y * 100 + (this.object.getSize().y * Math.sin(CAMERA_ANGLE)) / 2;\r\n\r\n            this.mesh.isPickable = true;\r\n        }\r\n    }\r\n}\r\n","import { DynamicTexture, Mesh, MeshBuilder, Texture, Vector3 } from 'babylonjs';\r\nimport { Scene } from 'babylonjs/scene';\r\nimport { AnimatedTexture } from './textures/AnimatedTexture';\r\nimport { createMaterial } from './textures/textureEngine';\r\nimport { Player } from '../60_Player';\r\nimport { AbstractEntityRenderer } from './01_AbstractEntityRenderer';\r\n\r\nexport class PlayerRenderer extends AbstractEntityRenderer {\r\n    private texture: AnimatedTexture;\r\n    private titleTexture: DynamicTexture;\r\n\r\n    constructor(protected object: Player, protected babylonScene: Scene) {\r\n        super(object, babylonScene);\r\n\r\n        if (!this.babylonScene) return;\r\n\r\n        const size = object.getSize();\r\n\r\n        this.mesh = MeshBuilder.CreatePlane(\r\n            object.id,\r\n            { width: size.x, height: size.y, sideOrientation: Mesh.FRONTSIDE },\r\n            this.babylonScene,\r\n        );\r\n        this.texture = new AnimatedTexture('player', this.babylonScene, 'default');\r\n        this.mesh.material = createMaterial(this.texture.getTexture(), this.babylonScene);\r\n\r\n        // Player title\r\n        const title = MeshBuilder.CreatePlane(\r\n            'title ' + object.id,\r\n            { width: 200, height: 40, sideOrientation: Mesh.FRONTSIDE },\r\n            this.babylonScene,\r\n        );\r\n        title.position = new Vector3(0, 110, -3);\r\n        const titleTexture = new DynamicTexture(\r\n            'titleTexture ' + object.id,\r\n            { width: 200, height: 40 },\r\n            this.babylonScene,\r\n            true,\r\n            Texture.LINEAR_LINEAR,\r\n        );\r\n        this.titleTexture = titleTexture;\r\n\r\n        title.parent = this.mesh;\r\n        title.material = createMaterial(titleTexture, this.babylonScene);\r\n\r\n        this.update();\r\n    }\r\n\r\n    async update() {\r\n        super.update();\r\n\r\n        const ctx = this.titleTexture.getContext();\r\n        ctx.clearRect(0, 0, this.titleTexture.getSize().width, this.titleTexture.getSize().height);\r\n        ctx.fillStyle = '#343434AA';\r\n        ctx.fillRect(0, 0, this.titleTexture.getSize().width, this.titleTexture.getSize().height);\r\n\r\n        ctx.font = '32px pixel';\r\n        ctx.textBaseline = 'middle';\r\n        ctx.textAlign = 'center';\r\n        ctx.fillStyle = '#FFFFFF';\r\n        ctx.fillText(this.object.name, this.titleTexture.getSize().width / 2, this.titleTexture.getSize().height / 2);\r\n        this.titleTexture.update();\r\n\r\n        const WALKING_THRESHOLD = 0.01;\r\n        if (\r\n            Math.abs(this.object.velocity.x) > WALKING_THRESHOLD ||\r\n            Math.abs(this.object.velocity.x) > WALKING_THRESHOLD\r\n        ) {\r\n            this.texture.queueOnce('walking');\r\n        } else {\r\n            this.texture.queueOnce('default');\r\n        }\r\n    }\r\n\r\n    detach() {\r\n        if (this.babylonScene && this.mesh) {\r\n            const child = this.mesh.getChildMeshes()[0];\r\n\r\n            if (this.titleTexture && child && child.material) {\r\n                this.babylonScene.removeTexture(this.titleTexture);\r\n                this.babylonScene.removeMaterial(child.material);\r\n            }\r\n        }\r\n\r\n        // Mesh detached by super\r\n        super.detach();\r\n    }\r\n}\r\n","import { Scene, Vector2 } from 'babylonjs';\r\nimport { GameScene } from '../Scene';\r\nimport { AbstractGameEntity, Platform, serializedEntity } from './20_AbstractGameEntity';\r\nimport { ControllerManager } from './controllers/ControllerManager';\r\nimport { ImmediateDeserializeController } from './controllers/controllers/deserializers/ImmediateDeserializeController';\r\nimport { SmoothDeserializeController } from './controllers/controllers/deserializers/SmoothDeserializeController';\r\nimport { KeyboardMotionController } from './controllers/controllers/input/KeyboardController';\r\nimport { PlayerRenderer } from './renderers/60_PlayerRenderer';\r\n\r\nexport interface serializedPlayer {\r\n    name: string;\r\n}\r\n\r\nexport class Player extends AbstractGameEntity {\r\n    public hitbox = { width: 0.5, height: 0.2 };\r\n\r\n    public name = '';\r\n\r\n    constructor(gameScene: GameScene, public id: string) {\r\n        super(gameScene, id);\r\n\r\n        this.controllerManager = new ControllerManager();\r\n    }\r\n\r\n    serialize(): serializedEntity<serializedPlayer> {\r\n        let sup = super.serialize() as serializedEntity<serializedPlayer>;\r\n        sup.type = Player.type;\r\n        sup.data = {\r\n            name: this.name,\r\n        };\r\n        return sup;\r\n    }\r\n\r\n    deserialize(serialized: serializedEntity<serializedPlayer>, timestamp: number): void {\r\n        if (serialized.type !== Player.type || timestamp < this.updatedAt) return;\r\n\r\n        this.name = serialized.data.name;\r\n        super.deserialize(serialized, timestamp);\r\n    }\r\n\r\n    tick(deltaTime: number) {\r\n        super.tick(deltaTime);\r\n        this.update();\r\n    }\r\n\r\n    static get type() {\r\n        return 'player';\r\n    }\r\n\r\n    async attachRenderer(scene: Scene) {\r\n        super.attachRenderer(scene);\r\n\r\n        this.renderer = new PlayerRenderer(this, scene);\r\n    }\r\n\r\n    attachControllers(platform: Platform, me?: boolean) {\r\n        if (platform === Platform.Server) {\r\n            this.controllerManager.attach(new ImmediateDeserializeController(this));\r\n        }\r\n        if (platform === Platform.Client) {\r\n            if (me) {\r\n                this.controllerManager.attach(new KeyboardMotionController(this));\r\n            } else {\r\n                this.controllerManager.attach(new SmoothDeserializeController(this));\r\n            }\r\n        }\r\n    }\r\n\r\n    getSize() {\r\n        return new Vector2(100, 200);\r\n    }\r\n}\r\n","export function getTerrainColor(number: number): string {\r\n    switch (number) {\r\n        case 1: // Grass\r\n            return '#67943F';\r\n        case 2: // Water\r\n            return '#2EB0E5';\r\n        case 4: // Sand\r\n            return '#FDDC86';\r\n    }\r\n    return '#DDDDDD';\r\n}\r\n\r\nexport function getEntityColor(type: string): string {\r\n    switch (type) {\r\n        case 'tree':\r\n            return '#2A4323aa';\r\n        case 'player':\r\n            return '#000dff';\r\n        case 'stone':\r\n            return '#ddddddaa';\r\n        case 'chicken':\r\n            return '#ffffff';\r\n    }\r\n    return '#DDDDDD';\r\n}\r\n","import { DynamicTexture, Mesh, MeshBuilder, Texture } from 'babylonjs';\r\nimport { Scene } from 'babylonjs/scene';\r\nimport { createMaterial, getImage } from './textures/textureEngine';\r\nimport { getTerrainColor } from '../../colors';\r\nimport { Chunk } from '../10_Chunk';\r\nimport { AbstractRenderer } from './00_AbstractRenderer';\r\n\r\nexport class ChunkRenderer extends AbstractRenderer {\r\n    private texture: DynamicTexture;\r\n\r\n    constructor(protected object: Chunk, protected babylonScene: Scene) {\r\n        super(object, babylonScene);\r\n\r\n        this.mesh = MeshBuilder.CreatePlane(\r\n            'chunk ' + object.id,\r\n            { width: 1600, height: 1600, sideOrientation: Mesh.FRONTSIDE },\r\n            this.babylonScene,\r\n        );\r\n        //this.mesh.receiveShadows = true;\r\n\r\n        const texture = new DynamicTexture(\r\n            'chunkTexture ' + object.id,\r\n            { width: 16 * 16, height: 16 * 16 },\r\n            this.babylonScene,\r\n            true,\r\n            Texture.NEAREST_NEAREST,\r\n        );\r\n\r\n        this.texture = texture;\r\n        const material = createMaterial(texture, this.babylonScene, true);\r\n        this.mesh.material = material;\r\n\r\n        this.update();\r\n    }\r\n\r\n    async update() {\r\n        this.mesh.position.x = this.object.position.x * 16 * 100;\r\n        this.mesh.position.y = -this.object.position.y * 16 * 100;\r\n\r\n        const ctx = this.texture.getContext();\r\n        this.drawTexture(ctx);\r\n        this.texture.update();\r\n    }\r\n\r\n    detach() {\r\n        if (this.babylonScene && this.mesh && this.texture) {\r\n            this.babylonScene.removeTexture(this.texture);\r\n            if (this.mesh.material) {\r\n                this.babylonScene.removeMaterial(this.mesh.material);\r\n            }\r\n        }\r\n\r\n        // Mesh detached by super\r\n        super.detach();\r\n    }\r\n\r\n    // Other functions:\r\n\r\n    static drawBasicTiling(chunk: Chunk, ctx: CanvasRenderingContext2D, shiftX: number, shiftY: number, size: number) {\r\n        for (let x = 0; x < 16; x++) {\r\n            for (let y = 0; y < 16; y++) {\r\n                if (chunk.ground[x] && chunk.ground[x][y]) {\r\n                    ctx.fillStyle = getTerrainColor(chunk.ground[x][y]);\r\n\r\n                    ctx.fillRect(shiftX + x * size, shiftY + y * size, size, size);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    drawTexture(ctx: CanvasRenderingContext2D) {\r\n        ChunkRenderer.drawBasicTiling(this.object, ctx, 0, 0, 16);\r\n\r\n        for (let x = 0; x < 16; x++) {\r\n            for (let y = 0; y < 16; y++) {\r\n                if (this.object.ground[x] && this.object.ground[x][y]) {\r\n                    if (this.object.ground[x][y] === 2) {\r\n                        // Water, should have transition\r\n                        this.drawTransition(ctx, x, y, [1, 3], 'grass_water');\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    drawTransition(ctx: CanvasRenderingContext2D, x: number, y: number, tileType: number[], filePrefix: string) {\r\n        const posX = this.object.position.x * 16 + x - 8;\r\n        const posY = this.object.position.y * 16 + y - 8;\r\n\r\n        let sides = '';\r\n        if (tileType.includes(this.object.gameScene.getTile(posX, posY - 1))) sides += 'T';\r\n        if (tileType.includes(this.object.gameScene.getTile(posX + 1, posY))) sides += 'R';\r\n        if (tileType.includes(this.object.gameScene.getTile(posX, posY + 1))) sides += 'B';\r\n        if (tileType.includes(this.object.gameScene.getTile(posX - 1, posY))) sides += 'L';\r\n\r\n        if (sides === 'TB') {\r\n            const top = getImage(filePrefix + '_T');\r\n            if (top) ctx.drawImage(top, x * 16, y * 16);\r\n            const bottom = getImage(filePrefix + '_B');\r\n            if (bottom) ctx.drawImage(bottom, x * 16, y * 16);\r\n        } else if (sides === 'RL') {\r\n            const right = getImage(filePrefix + '_R');\r\n            if (right) ctx.drawImage(right, x * 16, y * 16);\r\n            const left = getImage(filePrefix + '_L');\r\n            if (left) ctx.drawImage(left, x * 16, y * 16);\r\n        } else {\r\n            if (sides.length > 0) {\r\n                const img = getImage(filePrefix + '_' + sides);\r\n                if (img) ctx.drawImage(img, x * 16, y * 16);\r\n            }\r\n        }\r\n\r\n        const corner = (shiftX: number, shiftY: number, blackList: string[], suffix: string) => {\r\n            if (\r\n                tileType.includes(this.object.gameScene.getTile(posX + shiftX, posY + shiftY)) &&\r\n                !blackList.reduce((prev, letter) => prev || sides.includes(letter), false)\r\n            ) {\r\n                const img = getImage(filePrefix + '_corner_' + suffix);\r\n                if (img) ctx.drawImage(img, x * 16, y * 16);\r\n            }\r\n        };\r\n\r\n        corner(-1, -1, ['L', 'T'], 'BR');\r\n        corner(+1, -1, ['R', 'T'], 'BL');\r\n        corner(-1, +1, ['L', 'B'], 'TR');\r\n        corner(+1, +1, ['R', 'B'], 'TL');\r\n    }\r\n}\r\n","import { Scene, Vector2 } from 'babylonjs';\r\nimport { AbstractGameObject } from './00_AbstractGameObject';\r\nimport { GameScene } from '../Scene';\r\nimport { AbstractGameEntity } from './20_AbstractGameEntity';\r\nimport { ChunkRenderer } from './renderers/60_ChunkRenderer';\r\n\r\nexport type tileType = number;\r\n\r\nexport interface serializedChunk {\r\n    x: number;\r\n    y: number;\r\n    ground: tileType[][];\r\n}\r\n\r\nexport class Chunk extends AbstractGameObject {\r\n    public ground: tileType[][] = [[]];\r\n    public entities: Set<AbstractGameEntity> = new Set();\r\n\r\n    constructor(public gameScene: GameScene, x: number, y: number) {\r\n        super(gameScene);\r\n        this.position = new Vector2(x, y);\r\n    }\r\n\r\n    get id(): string {\r\n        return Chunk.getId(this.position.x, this.position.y);\r\n    }\r\n\r\n    serialize(): serializedChunk {\r\n        return {\r\n            x: this.position.x,\r\n            y: this.position.y,\r\n            ground: this.ground,\r\n        };\r\n    }\r\n\r\n    deserialize(serialized: serializedChunk): void {\r\n        this.position.x = serialized.x;\r\n        this.position.y = serialized.y;\r\n        this.ground = serialized.ground;\r\n\r\n        this.update();\r\n    }\r\n\r\n    static getId(x: number, y: number): string {\r\n        return x.toString() + 'x' + y.toString();\r\n    }\r\n\r\n    hasEntity(entity: AbstractGameEntity) {\r\n        return (\r\n            entity.position.x > this.position.x * 16 - 8 &&\r\n            entity.position.x < this.position.x * 16 + 8 &&\r\n            entity.position.y > this.position.y * 16 - 8 &&\r\n            entity.position.y < this.position.y * 16 + 8\r\n        );\r\n    }\r\n\r\n    public updateEntity(entity: AbstractGameEntity) {\r\n        if (this.hasEntity(entity)) {\r\n            if (!this.entities.has(entity)) {\r\n                this.entities.add(entity);\r\n            }\r\n        } else {\r\n            if (this.entities.has(entity)) {\r\n                this.entities.delete(entity);\r\n            }\r\n        }\r\n    }\r\n\r\n    async attachRenderer(scene: Scene) {\r\n        super.attachRenderer(scene);\r\n\r\n        this.renderer = new ChunkRenderer(this, scene);\r\n    }\r\n}\r\n","import { AbstractGameObject } from '../gameObjects/00_AbstractGameObject';\r\n\r\nexport class IndexedList<T extends AbstractGameObject> {\r\n    values: { [key: string]: T } = {};\r\n\r\n    addMore(values: { [key: string]: T }) {\r\n        this.values = { ...this.values, ...values };\r\n    }\r\n\r\n    add(key: string, value: T) {\r\n        this.values[key] = value;\r\n    }\r\n\r\n    remove(key: string) {\r\n        if (!this.values[key]) return;\r\n        this.values[key].detachRenderer();\r\n        delete this.values[key];\r\n    }\r\n\r\n    update(key: string, serialized: any, timestamp: number) {\r\n        if (!this.values[key]) return;\r\n        this.values[key].deserialize(serialized, timestamp);\r\n    }\r\n\r\n    updateOrCreate(key: string, serialized: any, newObjectCreator: () => T, timestamp: number) {\r\n        if (!this.values[key]) {\r\n            this.values[key] = newObjectCreator();\r\n        }\r\n        this.values[key].deserialize(serialized, timestamp);\r\n    }\r\n\r\n    get(key: string) {\r\n        if (!this.values[key]) return null;\r\n        return this.values[key];\r\n    }\r\n\r\n    includes(key: string) {\r\n        return !!this.values[key];\r\n    }\r\n\r\n    forEach(callbackfn: (value: T, key: string, index: number) => void) {\r\n        const keys = Object.keys(this.values);\r\n\r\n        keys.forEach((key, index) => {\r\n            callbackfn(this.values[key], key, index);\r\n        });\r\n    }\r\n\r\n    filter(callbackfn: (value: T, key: string, index: number) => boolean) {\r\n        const keys = Object.keys(this.values);\r\n\r\n        const result = new IndexedList<T>();\r\n\r\n        keys.forEach((key, index) => {\r\n            if (callbackfn(this.values[key], key, index)) {\r\n                result.add(key, this.values[key]);\r\n            }\r\n        });\r\n\r\n        return result;\r\n    }\r\n\r\n    map(callbackfn: (value: T, key: string, index: number) => any) {\r\n        return Object.keys(this.values).map((key, index) => callbackfn(this.values[key], key, index));\r\n    }\r\n\r\n    getValues() {\r\n        return Object.values(this.values);\r\n    }\r\n\r\n    getKeys() {\r\n        return Object.keys(this.values);\r\n    }\r\n\r\n    length() {\r\n        return this.getKeys().length;\r\n    }\r\n}\r\n","import { Chunk } from './gameObjects/10_Chunk';\r\nimport { IndexedList } from './utils/IndexedList';\r\nimport { AbstractGameEntity } from './gameObjects/20_AbstractGameEntity';\r\n\r\nexport class GameScene {\r\n    entities = new IndexedList<AbstractGameEntity>();\r\n    chunks = new IndexedList<Chunk>();\r\n    timeStart: number = new Date().getTime();\r\n\r\n    tickAll(deltaTime: number) {\r\n        this.entities.forEach((value) => value.tick(deltaTime));\r\n        this.chunks.forEach((value) => value.tick(deltaTime));\r\n    }\r\n\r\n    tickChunks(deltaTime: number, chunks: Set<Chunk>) {\r\n        chunks.forEach((chunk) => {\r\n            chunk.tick(deltaTime);\r\n            chunk.entities.forEach((entity) => entity.tick(deltaTime));\r\n        });\r\n    }\r\n\r\n    public updateEntity(entity: AbstractGameEntity) {\r\n        this.chunks.forEach((value) => value.updateEntity(entity));\r\n    }\r\n\r\n    getTile(x: number, y: number) {\r\n        const calcX = Math.floor(x) + 8;\r\n        const calcY = Math.floor(y) + 8;\r\n\r\n        const chunkX = Math.floor(calcX / 16);\r\n        const chunkY = Math.floor(calcY / 16);\r\n        const chunk = this.chunks.get(Chunk.getId(chunkX, chunkY));\r\n\r\n        if (!chunk || !chunk.ground[calcX - chunkX * 16] || !chunk.ground[calcX - chunkX * 16][calcY - chunkY * 16]) {\r\n            return -1;\r\n        }\r\n\r\n        return chunk.ground[calcX - chunkX * 16][calcY - chunkY * 16];\r\n    }\r\n\r\n    getColisions(entity: AbstractGameEntity) {\r\n        return this.entities.filter((value) => entity !== value && value.colidesWith(entity));\r\n    }\r\n\r\n    getClosestEntityOfType(entity: AbstractGameEntity, type: any) {\r\n        const closest = this.entities\r\n            .filter((e) => e instanceof type)\r\n            .getValues()\r\n            .sort((a, b) => this.distance(entity, a) - this.distance(entity, b));\r\n\r\n        if (closest[0]) {\r\n            return {\r\n                entity: closest[0],\r\n                distance: this.distance(entity, closest[0]),\r\n            };\r\n        }\r\n        return null;\r\n    }\r\n\r\n    private distance(a: AbstractGameEntity, b: AbstractGameEntity) {\r\n        return Math.sqrt(Math.pow(a.position.x - b.position.x, 2) + Math.pow(a.position.y - b.position.y, 2));\r\n    }\r\n\r\n    getTime() {\r\n        const REAL_TO_INGAME_TIME = 1 * 60;\r\n        let time = (Math.abs(new Date().getTime() - this.timeStart) / 1000) * REAL_TO_INGAME_TIME + 12 * 60 * 60;\r\n\r\n        return {\r\n            day: time / (60 * 60 * 24),\r\n            hour: (time / (60 * 60)) % 24,\r\n            min: (time / 60) % 60,\r\n            sec: time % 60,\r\n        };\r\n    }\r\n}\r\n","import { keyBindings } from '../shared/gameObjects/controllers/controllers/input/KeyboardController';\r\n\r\n// ARROWS\r\nexport const CONTROLS_ARROWS: keyBindings = {\r\n    left: 37,\r\n    right: 39,\r\n    up: 38,\r\n    down: 40,\r\n};\r\n\r\n// WASD\r\nexport const CONTROLS_WASD: keyBindings = {\r\n    left: 65,\r\n    right: 68,\r\n    up: 87,\r\n    down: 83,\r\n};\r\n","import { Mesh, MeshBuilder } from 'babylonjs';\r\nimport { Scene } from 'babylonjs/scene';\r\nimport { getSimpleMaterial } from './textures/textureEngine';\r\nimport { AbstractGameEntity } from '../20_AbstractGameEntity';\r\nimport { AbstractEntityRenderer } from './01_AbstractEntityRenderer';\r\n\r\n/**\r\n * Renders entity with interchangeable static materials.\r\n *\r\n * Material is updated on every `update()` call and is obtained calling `getMaterial` function\r\n */\r\nexport class StaticRenderer extends AbstractEntityRenderer {\r\n    constructor(\r\n        protected object: AbstractGameEntity,\r\n        protected babylonScene: Scene,\r\n        private getMaterial: () => string,\r\n    ) {\r\n        super(object, babylonScene);\r\n\r\n        const size = object.getSize();\r\n\r\n        this.mesh = MeshBuilder.CreatePlane(\r\n            object.id,\r\n            { width: size.x, height: size.y, sideOrientation: Mesh.FRONTSIDE },\r\n            this.babylonScene,\r\n        );\r\n        this.update();\r\n    }\r\n\r\n    async update() {\r\n        super.update();\r\n        this.mesh.material = getSimpleMaterial(this.getMaterial(), this.babylonScene);\r\n    }\r\n}\r\n","import { Scene, Vector2 } from 'babylonjs';\r\nimport { GameScene } from '../Scene';\r\nimport { AbstractGameEntity, Platform, serializedEntity } from './20_AbstractGameEntity';\r\nimport { ControllerManager } from './controllers/ControllerManager';\r\nimport { ImmediateDeserializeController } from './controllers/controllers/deserializers/ImmediateDeserializeController';\r\nimport { StaticRenderer } from './renderers/11_StaticRenderer';\r\n\r\ntype treeTypes = 1 | 2 | 3 | 4;\r\n\r\nexport interface serializedTree {\r\n    size: treeTypes;\r\n}\r\n\r\nexport class Tree extends AbstractGameEntity {\r\n    public hitbox = { width: 0.2, height: 0.2 };\r\n\r\n    public size: treeTypes;\r\n\r\n    constructor(gameScene: GameScene, public id: string) {\r\n        super(gameScene, id);\r\n\r\n        this.controllerManager = new ControllerManager();\r\n    }\r\n\r\n    serialize(): serializedEntity<serializedTree> {\r\n        let sup = super.serialize() as serializedEntity<serializedTree>;\r\n        sup.type = Tree.type;\r\n        sup.data = {\r\n            size: this.size,\r\n        };\r\n        return sup;\r\n    }\r\n\r\n    deserialize(serialized: serializedEntity<serializedTree>, timestamp: number): void {\r\n        if (serialized.type !== Tree.type || timestamp < this.updatedAt) return;\r\n\r\n        this.size = serialized.data.size;\r\n        super.deserialize(serialized, timestamp);\r\n    }\r\n\r\n    static get type() {\r\n        return 'tree';\r\n    }\r\n\r\n    async attachRenderer(scene: Scene) {\r\n        super.attachRenderer(scene);\r\n\r\n        this.renderer = new StaticRenderer(this, scene, () => this.getMaterial());\r\n    }\r\n\r\n    attachControllers(platform: Platform) {\r\n        if (platform === Platform.Server) {\r\n            this.controllerManager.attach(new ImmediateDeserializeController(this));\r\n        }\r\n        if (platform === Platform.Client) {\r\n            this.controllerManager.attach(new ImmediateDeserializeController(this));\r\n        }\r\n    }\r\n\r\n    getMaterial() {\r\n        switch (this.size) {\r\n            case 1:\r\n                return 'tree_small';\r\n            case 2:\r\n                return 'tree_big';\r\n            case 3:\r\n                return 'tree_short';\r\n            case 4:\r\n                return 'tree_tall';\r\n        }\r\n    }\r\n\r\n    getSize() {\r\n        return new Vector2(200, 400);\r\n    }\r\n}\r\n","import { Scene, Vector2 } from 'babylonjs';\r\nimport { GameScene } from '../Scene';\r\nimport { AbstractGameEntity, Platform, serializedEntity } from './20_AbstractGameEntity';\r\nimport { ControllerManager } from './controllers/ControllerManager';\r\nimport { ImmediateDeserializeController } from './controllers/controllers/deserializers/ImmediateDeserializeController';\r\nimport { StaticRenderer } from './renderers/11_StaticRenderer';\r\n\r\nexport interface serializedStone {\r\n    size: 1 | 2;\r\n}\r\n\r\nexport class Stone extends AbstractGameEntity {\r\n    public hitbox = { width: 0.2, height: 0.2 };\r\n\r\n    public size: 1 | 2;\r\n\r\n    constructor(gameScene: GameScene, public id: string) {\r\n        super(gameScene, id);\r\n\r\n        this.controllerManager = new ControllerManager();\r\n    }\r\n\r\n    serialize(): serializedEntity<serializedStone> {\r\n        let sup = super.serialize() as serializedEntity<serializedStone>;\r\n        sup.type = Stone.type;\r\n        sup.data = {\r\n            size: this.size,\r\n        };\r\n        return sup;\r\n    }\r\n\r\n    deserialize(serialized: serializedEntity<serializedStone>, timestamp: number): void {\r\n        if (serialized.type !== Stone.type || timestamp < this.updatedAt) return;\r\n\r\n        this.size = serialized.data.size;\r\n        super.deserialize(serialized, timestamp);\r\n    }\r\n\r\n    static get type() {\r\n        return 'stone';\r\n    }\r\n\r\n    async attachRenderer(scene: Scene) {\r\n        super.attachRenderer(scene);\r\n\r\n        this.renderer = new StaticRenderer(this, scene, () => (this.size === 1 ? 'rock_small' : 'rock_big'));\r\n    }\r\n\r\n    attachControllers(platform: Platform) {\r\n        if (platform === Platform.Server) {\r\n            this.controllerManager.attach(new ImmediateDeserializeController(this));\r\n        }\r\n        if (platform === Platform.Client) {\r\n            this.controllerManager.attach(new ImmediateDeserializeController(this));\r\n        }\r\n    }\r\n\r\n    getSize() {\r\n        return new Vector2(100, 100);\r\n    }\r\n}\r\n","import { Chicken } from '../../../60_Chicken';\r\nimport { Player } from '../../../60_Player';\r\nimport { AbstractController } from '../AbstractController';\r\n\r\nconst ROTATION_SPEED = 0.03;\r\nconst SPEED = 0.001;\r\nconst SPEED2 = 0.0035;\r\n\r\nexport class ChickenAIController extends AbstractController {\r\n    angle: number = 0;\r\n\r\n    constructor(protected object: Chicken) {\r\n        super(object);\r\n    }\r\n\r\n    public tick(deltaTime: number) {\r\n        const closestPlayer = this.object.gameScene.getClosestEntityOfType(this.object, Player);\r\n        if (closestPlayer && closestPlayer.distance < 2) {\r\n            this.object.inLove = closestPlayer.entity.id;\r\n        }\r\n        if (closestPlayer && closestPlayer.distance < 10) {\r\n            let rotate = 0;\r\n            if (this.object.inLove !== closestPlayer.entity.id) {\r\n                rotate = Math.PI;\r\n            }\r\n\r\n            this.angle =\r\n                Math.atan2(\r\n                    closestPlayer.entity.position.y - this.object.position.y,\r\n                    closestPlayer.entity.position.x - this.object.position.x,\r\n                ) + rotate;\r\n\r\n            this.object.velocity.x = Math.cos(this.angle) * SPEED2 * deltaTime;\r\n            this.object.velocity.y = Math.sin(this.angle) * SPEED2 * deltaTime;\r\n        } else {\r\n            this.angle += (Math.random() - 0.5) * 2 * ROTATION_SPEED * deltaTime;\r\n\r\n            this.object.velocity.x = Math.cos(this.angle) * SPEED * deltaTime;\r\n            this.object.velocity.y = Math.sin(this.angle) * SPEED * deltaTime;\r\n        }\r\n\r\n        const ogX = this.object.position.x;\r\n        const ogY = this.object.position.y;\r\n\r\n        this.object.position.x += this.object.velocity.x;\r\n        this.object.position.y += this.object.velocity.y;\r\n\r\n        if (Math.abs(this.object.velocity.x) < 0.001) {\r\n            this.object.velocity.x = 0;\r\n        }\r\n        if (Math.abs(this.object.velocity.y) < 0.001) {\r\n            this.object.velocity.y = 0;\r\n        }\r\n\r\n        // Colisions\r\n        const colisions = this.object.gameScene.getColisions(this.object);\r\n        if (colisions.length() > 0) {\r\n            let colisionX = false;\r\n            let colisionY = false;\r\n\r\n            colisions.forEach((entity) => {\r\n                let colisionFromBottom =\r\n                    !(ogY - this.object.hitbox.height < entity.position.y + entity.hitbox.height) &&\r\n                    this.object.position.y - this.object.hitbox.height < entity.position.y + entity.hitbox.height;\r\n\r\n                let colisionFromLeft =\r\n                    !(ogX + this.object.hitbox.width > entity.position.x - entity.hitbox.width) &&\r\n                    this.object.position.x + this.object.hitbox.width > entity.position.x - entity.hitbox.width;\r\n\r\n                let colisionFromTop =\r\n                    !(ogY + this.object.hitbox.height > entity.position.y - entity.hitbox.height) &&\r\n                    this.object.position.y + this.object.hitbox.height > entity.position.y - entity.hitbox.height;\r\n\r\n                let colisionFromRight =\r\n                    !(ogX - this.object.hitbox.width < entity.position.x + entity.hitbox.width) &&\r\n                    this.object.position.x - this.object.hitbox.width < entity.position.x + entity.hitbox.width;\r\n\r\n                colisionX = colisionX || colisionFromLeft || colisionFromRight;\r\n                colisionY = colisionY || colisionFromBottom || colisionFromTop;\r\n            });\r\n\r\n            if (colisionX) {\r\n                this.object.position.x = ogX;\r\n                this.object.velocity.x = 0;\r\n            }\r\n            if (colisionY) {\r\n                this.object.position.y = ogY;\r\n                this.object.velocity.y = 0;\r\n            }\r\n        }\r\n\r\n        this.object.setDirty();\r\n\r\n        // TODO: Collisions\r\n    }\r\n}\r\n","import { Mesh, MeshBuilder } from 'babylonjs';\r\nimport { Scene } from 'babylonjs/scene';\r\nimport { getSimpleMaterial } from './textures/textureEngine';\r\nimport { AbstractGameEntity } from '../20_AbstractGameEntity';\r\nimport { AbstractEntityRenderer } from './01_AbstractEntityRenderer';\r\n\r\n/**\r\n * Renders entity with single static material.\r\n */\r\nexport class SimpleRenderer extends AbstractEntityRenderer {\r\n    constructor(protected object: AbstractGameEntity, protected babylonScene: Scene, private material: string) {\r\n        super(object, babylonScene);\r\n\r\n        const size = object.getSize();\r\n\r\n        this.mesh = MeshBuilder.CreatePlane(\r\n            object.id,\r\n            { width: size.x, height: size.y, sideOrientation: Mesh.FRONTSIDE },\r\n            this.babylonScene,\r\n        );\r\n        this.mesh.material = getSimpleMaterial(material, this.babylonScene);\r\n\r\n        this.update();\r\n    }\r\n}\r\n","import { Scene, Vector2 } from 'babylonjs';\r\nimport { GameScene } from '../Scene';\r\nimport { AbstractGameEntity, Platform, serializedEntity } from './20_AbstractGameEntity';\r\nimport { ControllerManager } from './controllers/ControllerManager';\r\nimport { ChickenAIController } from './controllers/controllers/ai/ChickenAIController';\r\nimport { SmoothDeserializeController } from './controllers/controllers/deserializers/SmoothDeserializeController';\r\nimport { SimpleRenderer } from './renderers/10_SimpleRenderer';\r\n\r\nexport interface serializedChicken {\r\n    inLove: string;\r\n}\r\n\r\nexport class Chicken extends AbstractGameEntity {\r\n    public hitbox = { width: 0.2, height: 0.2 };\r\n\r\n    public inLove: string = '';\r\n\r\n    constructor(gameScene: GameScene, public id: string) {\r\n        super(gameScene, id);\r\n\r\n        this.controllerManager = new ControllerManager();\r\n    }\r\n\r\n    serialize(): serializedEntity<serializedChicken> {\r\n        let sup = super.serialize() as serializedEntity<serializedChicken>;\r\n        sup.type = Chicken.type;\r\n        sup.data = {\r\n            inLove: this.inLove,\r\n        };\r\n        return sup;\r\n    }\r\n\r\n    deserialize(serialized: serializedEntity<serializedChicken>, timestamp: number): void {\r\n        if (serialized.type !== Chicken.type || timestamp < this.updatedAt) return;\r\n\r\n        super.deserialize(serialized, timestamp);\r\n    }\r\n\r\n    static get type() {\r\n        return 'chicken';\r\n    }\r\n\r\n    async attachRenderer(scene: Scene) {\r\n        super.attachRenderer(scene);\r\n\r\n        this.renderer = new SimpleRenderer(this, scene, 'chicken');\r\n    }\r\n\r\n    attachControllers(platform: Platform) {\r\n        if (platform === Platform.Server) {\r\n            this.controllerManager.attach(new ChickenAIController(this));\r\n        }\r\n        if (platform === Platform.Client) {\r\n            this.controllerManager.attach(new SmoothDeserializeController(this));\r\n            this.controllerManager.invoke('setSmoothTime', 200);\r\n        }\r\n    }\r\n\r\n    getSize() {\r\n        return new Vector2(100, 100);\r\n    }\r\n}\r\n","import io from 'socket.io-client';\r\nimport { Player, serializedPlayer } from '../../../shared/gameObjects/60_Player';\r\nimport { GameScene } from '../../../shared/Scene';\r\nimport babylonjs from 'babylonjs';\r\nimport { serializedChunk, Chunk } from '../../../shared/gameObjects/10_Chunk';\r\nimport {\r\n    messageAuth,\r\n    messageEntities,\r\n    messageError,\r\n    messageLogin,\r\n    messageUpdate,\r\n} from '../../../shared/network/messageTypes';\r\nimport { AbstractGameEntity, Platform, serializedEntity } from '../../../shared/gameObjects/20_AbstractGameEntity';\r\nimport { Tree } from '../../../shared/gameObjects/60_Tree';\r\nimport { Stone } from '../../../shared/gameObjects/60_Stone';\r\nimport md5 from 'md5';\r\nimport { Chicken } from '../../../shared/gameObjects/60_Chicken';\r\n\r\ntype callback = (data: any) => void;\r\n\r\nexport class NetworkClient {\r\n    private updateSocket: SocketIOClient.Socket;\r\n    private largeDataSocket: SocketIOClient.Socket | null;\r\n\r\n    private userId: string;\r\n    private callbacks: { [key: string]: callback } = {\r\n        authenticated: () => {},\r\n        updated: () => {},\r\n        invalidPassword: () => {},\r\n        disconnect: () => {},\r\n    };\r\n    private token: string;\r\n\r\n    private player: serializedEntity<serializedPlayer>;\r\n\r\n    constructor(private apiUrl: string, private scene: GameScene, private getBabylonScene: () => babylonjs.Scene) {}\r\n\r\n    public on(event: 'authenticated' | 'updated' | 'invalidPassword' | 'disconnect', callback: callback) {\r\n        this.callbacks[event] = callback;\r\n    }\r\n\r\n    public close() {\r\n        this.updateSocket.disconnect();\r\n        this.updateSocket && this.updateSocket.disconnect();\r\n        this.largeDataSocket && this.largeDataSocket.disconnect();\r\n    }\r\n\r\n    public open() {\r\n        this.updateSocket = io(this.apiUrl);\r\n        this.setServiceListeners(this.updateSocket);\r\n    }\r\n\r\n    private enableGameListeners() {\r\n        this.largeDataSocket = io(this.apiUrl);\r\n        this.largeDataSocket.on('ok', (_data: '') => {\r\n            console.log('Secondary socket connected!');\r\n            this.setMainListeners(this.updateSocket);\r\n            this.setMainListeners(this.largeDataSocket!);\r\n\r\n            this.callbacks['authenticated'](this.player);\r\n        });\r\n        this.largeDataSocket.emit('token', { token: this.token, type: 'data' });\r\n    }\r\n\r\n    private setMainListeners(socket: SocketIOClient.Socket) {\r\n        socket.on('entities', async (data: messageEntities) => {\r\n            data.removed.forEach((entity) => entity !== this.userId && this.scene.entities.remove(entity));\r\n            data.updated.forEach(\r\n                (entity) =>\r\n                    entity.id !== this.userId &&\r\n                    this.scene.entities.updateOrCreate(\r\n                        entity.id,\r\n                        entity,\r\n                        () => this.createEntity(entity)!,\r\n                        data.timestamp,\r\n                    ),\r\n            );\r\n\r\n            this.scene.timeStart = data.time;\r\n            this.callbacks.updated({});\r\n        });\r\n\r\n        socket.on('mapChunk', async (data: serializedChunk) => {\r\n            const id = Chunk.getId(data.x, data.y);\r\n\r\n            this.scene.chunks.updateOrCreate(\r\n                id,\r\n                data,\r\n                () => {\r\n                    const chunk = new Chunk(this.scene, data.x, data.y);\r\n                    chunk.attachRenderer(this.getBabylonScene());\r\n                    return chunk;\r\n                },\r\n                0,\r\n            );\r\n        });\r\n    }\r\n\r\n    private setServiceListeners(socket: SocketIOClient.Socket) {\r\n        socket.on('auth', (data: messageAuth) => {\r\n            this.userId = data.player.id;\r\n            this.token = data.token;\r\n            console.log(\r\n                'Joined game with player ' +\r\n                    data.player.data.name +\r\n                    ' (' +\r\n                    data.player.id +\r\n                    '), waiting for second socket...',\r\n            );\r\n            this.enableGameListeners();\r\n            this.player = data.player;\r\n        });\r\n\r\n        socket.on('err', async (data: messageError) => {\r\n            switch (data.error) {\r\n                case 'credentials':\r\n                    this.callbacks.invalidPassword(data);\r\n            }\r\n        });\r\n    }\r\n\r\n    public sendPlayerUpdate(player: Player) {\r\n        const payload: messageUpdate = {\r\n            player: player.serialize(),\r\n            loadedChunks: this.scene.chunks.filter((ch) => ch.getVisibility()).map((ch) => ch.id),\r\n            timestamp: new Date().getTime(),\r\n        };\r\n        this.updateSocket && this.updateSocket.emit('update', payload);\r\n    }\r\n\r\n    public requestChunk(x: number, y: number) {\r\n        this.updateSocket && this.updateSocket.emit('mapRequest', { x, y });\r\n    }\r\n\r\n    public auth(name: string, password: string) {\r\n        const payload: messageLogin = {\r\n            name,\r\n            passwordHash: md5(password),\r\n        };\r\n        this.updateSocket.emit('login', payload);\r\n    }\r\n\r\n    private createEntity(entity: serializedEntity<any>): AbstractGameEntity | undefined {\r\n        let e = null;\r\n        switch (entity.type) {\r\n            case 'player': {\r\n                e = new Player(this.scene, entity.id);\r\n                break;\r\n            }\r\n            case 'tree': {\r\n                e = new Tree(this.scene, entity.id);\r\n                break;\r\n            }\r\n            case 'stone': {\r\n                e = new Stone(this.scene, entity.id);\r\n                break;\r\n            }\r\n            case 'chicken': {\r\n                e = new Chicken(this.scene, entity.id);\r\n                break;\r\n            }\r\n        }\r\n        if (e) {\r\n            e.deserializeImmediatelly(entity, 0);\r\n            e.attachControllers(Platform.Client);\r\n            e.attachDirtyListener((entity) => this.scene.updateEntity(entity));\r\n            return e;\r\n        }\r\n        console.error('Entity \"' + entity.type + ' does not exist!');\r\n    }\r\n}\r\n","export function shadeText(ctx: CanvasRenderingContext2D, text: string, x: number, y: number) {\r\n    ctx.strokeStyle = '#000000';\r\n    ctx.fillStyle = '#FFFFFF';\r\n    ctx.lineWidth = 2;\r\n\r\n    ctx.strokeText(text, x, y);\r\n    ctx.strokeText(text, x + 1, y + 1);\r\n    ctx.fillText(text, x, y);\r\n}\r\n","import React, { createRef } from 'react';\r\n\r\nimport babylonjs, { Vector3, UniversalCamera, StandardMaterial, MeshBuilder, DirectionalLight } from 'babylonjs';\r\nimport { Scene, Engine, SceneEventArgs } from 'react-babylonjs';\r\n\r\nimport { AdvancedDynamicTexture } from '@babylonjs/gui/2D/advancedDynamicTexture';\r\nimport { Player, serializedPlayer } from '../../shared/gameObjects/60_Player';\r\nimport { Chunk } from '../../shared/gameObjects/10_Chunk';\r\nimport { GameScene } from '../../shared/Scene';\r\nimport { CONTROLS_WASD } from '../keyBindings';\r\nimport { NetworkClient } from './network/Client';\r\nimport { minimap } from './gui/minimap';\r\nimport { debugInfo } from './gui/debugInfo';\r\nimport { CAMERA_ANGLE, CAMERA_DISTANCE } from '../../shared/constants';\r\nimport { shadeText } from './utils/shadeText';\r\nimport { AbstractGameEntity, Platform, serializedEntity } from '../../shared/gameObjects/20_AbstractGameEntity';\r\n\r\nexport const MAX_RENDER_DISTANCE = 3;\r\nconst REQUEST_DISTANCE = 3;\r\nconst DELETE_DISTANCE = 5;\r\n\r\ninterface IGameCoreProps {\r\n    apiUrl: string;\r\n}\r\n\r\ninterface IGameCoreState {\r\n    loggedIn: boolean;\r\n}\r\n\r\nexport class GameCore extends React.Component<IGameCoreProps, IGameCoreState> {\r\n    gameScene: GameScene;\r\n    me: Player | null = null;\r\n\r\n    babylonScene: babylonjs.Scene | null;\r\n    guiTexture: AdvancedDynamicTexture | null;\r\n    networkClient: NetworkClient;\r\n    state: IGameCoreState = {\r\n        loggedIn: false,\r\n    };\r\n\r\n    timer: NodeJS.Timeout;\r\n\r\n    zoom: number = 1;\r\n    renderDistance: number = MAX_RENDER_DISTANCE;\r\n\r\n    debug: boolean = false;\r\n\r\n    loginRef = createRef<HTMLInputElement>();\r\n    passwordRef = createRef<HTMLInputElement>();\r\n\r\n    mouseEntity: AbstractGameEntity | null;\r\n\r\n    constructor(props: IGameCoreProps) {\r\n        super(props);\r\n\r\n        this.gameScene = new GameScene();\r\n        this.networkClient = new NetworkClient(this.props.apiUrl, this.gameScene, () => this.babylonScene!);\r\n        this.networkClient.on('authenticated', (data: serializedEntity<serializedPlayer>) => this.initGame(data));\r\n        this.networkClient.on('invalidPassword', () => {\r\n            if (this.loginRef.current && this.passwordRef.current) {\r\n                this.loginRef.current.classList.add('shake');\r\n                this.passwordRef.current.classList.add('shake');\r\n                setTimeout(() => {\r\n                    if (this.loginRef.current && this.passwordRef.current) {\r\n                        this.loginRef.current.classList.remove('shake');\r\n                        this.passwordRef.current.classList.remove('shake');\r\n                    }\r\n                }, 600);\r\n            }\r\n        });\r\n\r\n        document.addEventListener('keydown', (event) => {\r\n            this.gameScene.entities.forEach((entity) => entity.controllerManager.invoke('keyDown', event.keyCode));\r\n        });\r\n\r\n        document.addEventListener('keyup', (event) => {\r\n            this.gameScene.entities.forEach((entity) => entity.controllerManager.invoke('keyUp', event.keyCode));\r\n        });\r\n\r\n        document.addEventListener('wheel', (event) => {\r\n            this.zoom += (event.deltaY / Math.abs(event.deltaY)) * 0.12;\r\n            if (this.zoom < 0.5) this.zoom = 0.5;\r\n            if (this.zoom > 3) this.zoom = 3;\r\n        });\r\n\r\n        window.addEventListener('resize', (event) => {\r\n            this.resize();\r\n        });\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.resize();\r\n        this.networkClient.open();\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        clearInterval(this.timer);\r\n        this.networkClient.close();\r\n    }\r\n\r\n    initGame(player: serializedEntity<serializedPlayer>) {\r\n        this.setState({\r\n            loggedIn: true,\r\n        });\r\n        this.me = new Player(this.gameScene, player.id);\r\n        this.me.attachRenderer(this.babylonScene!);\r\n        this.me.attachControllers(Platform.Client, true);\r\n        this.me.controllerManager.invoke('bindKeys', CONTROLS_WASD);\r\n        this.me.deserializeImmediatelly(player, 0);\r\n        this.gameScene.entities.add(player.id, this.me);\r\n        this.me.attachDirtyListener((entity) => this.gameScene.updateEntity(entity));\r\n\r\n        (window as any).player = this.me;\r\n        (window as any).scene = this.gameScene;\r\n        (window as any).enableDebug = () => {\r\n            this.babylonScene && this.babylonScene.debugLayer.show();\r\n            this.debug = true;\r\n        };\r\n\r\n        this.timer = setInterval(async () => {\r\n            if (this.me) this.networkClient.sendPlayerUpdate(this.me);\r\n        }, 100);\r\n    }\r\n\r\n    tick(deltaTime: number) {\r\n        this.gameScene.entities.forEach((entity) => entity.tick(deltaTime));\r\n\r\n        this.unloadUnusedComponents();\r\n        this.requestChunks();\r\n\r\n        if (this.guiTexture) {\r\n            if (this.me) {\r\n                const gui = this.guiTexture.getContext();\r\n                const width = this.guiTexture.getSize().width;\r\n                const height = this.guiTexture.getSize().height;\r\n                gui.clearRect(0, 0, width, height);\r\n\r\n                minimap(this.guiTexture, this.gameScene, this.me);\r\n                if (this.debug) {\r\n                    debugInfo(this.guiTexture, this.gameScene, deltaTime);\r\n                }\r\n\r\n                this.guiTexture.update();\r\n            } else {\r\n                const gui = this.guiTexture.getContext();\r\n                const width = this.guiTexture.getSize().width;\r\n                const height = this.guiTexture.getSize().height;\r\n                gui.fillStyle = '#33334C';\r\n                gui.fillRect(0, 0, width, height);\r\n\r\n                gui.fillStyle = '#FFFFFF';\r\n                gui.font = '20px pixel';\r\n                gui.textBaseline = 'middle';\r\n                gui.textAlign = 'center';\r\n\r\n                shadeText(gui, 'Připojování k serveru...', width / 2, height / 2);\r\n\r\n                this.guiTexture.update();\r\n            }\r\n        }\r\n    }\r\n\r\n    resize() {\r\n        const canvas = document.getElementById('game') as HTMLCanvasElement;\r\n        if (canvas) {\r\n            canvas.width = window.innerWidth;\r\n            canvas.height = window.innerHeight;\r\n        }\r\n    }\r\n\r\n    onSceneMount(event: SceneEventArgs) {\r\n        const { scene } = event;\r\n\r\n        this.babylonScene = (scene as any) as babylonjs.Scene;\r\n\r\n        const camera = new UniversalCamera('Camera', new Vector3(0, 0, CAMERA_DISTANCE), this.babylonScene);\r\n        camera.rotation = new Vector3(-CAMERA_ANGLE, 0, 0);\r\n        //camera.attachControl(event.canvas, true);\r\n\r\n        const skybox = MeshBuilder.CreateCylinder(\r\n            'skyBox',\r\n            {\r\n                height: CAMERA_DISTANCE * 100,\r\n                diameterTop: MAX_RENDER_DISTANCE * 16 * 100 * 3,\r\n                diameterBottom: MAX_RENDER_DISTANCE * 16 * 100 * 1,\r\n                tessellation: 24,\r\n            },\r\n            this.babylonScene,\r\n        );\r\n\r\n        const nightLight = new DirectionalLight('nightLight', new Vector3(0, 1, 2), this.babylonScene);\r\n        nightLight.diffuse = new BABYLON.Color3(0.5, 0.5, 1);\r\n        const nightLightIntensity = 0.5;\r\n\r\n        const dayLight = new DirectionalLight('dayLight', new Vector3(0, 1, 2), this.babylonScene);\r\n        dayLight.diffuse = new BABYLON.Color3(1, 1, 1);\r\n        const dayLightIntensity = 1.5;\r\n\r\n        //const shadowGenerator = new ShadowGenerator(1024, light);\r\n        //shadowGenerator.useExponentialShadowMap = true;\r\n\r\n        const skyboxMaterial = new StandardMaterial('skyBox', this.babylonScene);\r\n        skyboxMaterial.backFaceCulling = false;\r\n        skyboxMaterial.diffuseColor = new BABYLON.Color3(0, 0, 0);\r\n        skyboxMaterial.specularColor = new BABYLON.Color3(0, 0, 0);\r\n        skyboxMaterial.disableLighting = true;\r\n        skybox.material = skyboxMaterial;\r\n        skybox.rotation = new Vector3(Math.PI / 2, 0, 0);\r\n\r\n        this.guiTexture = AdvancedDynamicTexture.CreateFullscreenUI('GUI', true, scene);\r\n\r\n        scene.onPointerDown = (event, pickResult) => {\r\n            if (pickResult.hit && pickResult.pickedMesh && !pickResult.pickedMesh.name.startsWith('chunk')) {\r\n                this.mouseEntity = this.gameScene.entities.get(pickResult.pickedMesh.name.split(' ')[1]);\r\n                if (this.mouseEntity) {\r\n                    this.mouseEntity.controllerManager.invoke('mouseDown', event.button);\r\n                }\r\n            } else {\r\n                this.mouseEntity = null;\r\n            }\r\n        };\r\n        scene.onPointerUp = (event) => {\r\n            if (this.mouseEntity) {\r\n                this.mouseEntity.controllerManager.invoke('mouseUp', event.button);\r\n            }\r\n        };\r\n\r\n        /*\r\n        var pipeline = new BABYLON.LensRenderingPipeline(\r\n            'lens',\r\n            {\r\n                edge_blur: 0.2,\r\n                chromatic_aberration: 0.2,\r\n                distortion: 0.1,\r\n                grain_amount: 0.1,\r\n\r\n                dof_focus_distance: (CAMERA_DISTANCE * this.zoom) / Math.cos(CAMERA_ANGLE),\r\n                dof_aperture: 100, // set this very high for tilt-shift effect\r\n                dof_pentagon: true,\r\n                dof_gain: 1.0,\r\n                dof_threshold: 1.0,\r\n                dof_darken: 0.25,\r\n            },\r\n            scene as any,\r\n            1.0,\r\n            camera as any,\r\n        );\r\n        */\r\n\r\n        scene.getEngine().runRenderLoop(() => {\r\n            this.tick(scene.getEngine().getDeltaTime());\r\n            //this.gameScene.time += scene.getEngine().getDeltaTime();\r\n\r\n            (async () => {\r\n                /*\r\n                this.gameScene.entities.forEach((entity) => {\r\n                    entity.renderer && shadowGenerator.addShadowCaster(entity.renderer.mesh);\r\n                });\r\n                */\r\n                if (this.me) {\r\n                    camera.position = new Vector3(\r\n                        this.me.position.x * 100,\r\n                        -this.me.position.y * 100 - CAMERA_DISTANCE * this.zoom * Math.tan(CAMERA_ANGLE),\r\n                        -CAMERA_DISTANCE * this.zoom,\r\n                    );\r\n\r\n                    const time = this.gameScene.getTime();\r\n                    if (time.hour > 9 && time.hour < 18) {\r\n                        dayLight.intensity = dayLightIntensity;\r\n                        nightLight.intensity = 0;\r\n                    }\r\n                    if (time.hour > 21 || time.hour < 6) {\r\n                        dayLight.intensity = 0;\r\n                        nightLight.intensity = nightLightIntensity;\r\n                    }\r\n                    if (time.hour > 6 && time.hour < 9) {\r\n                        const change = (time.hour - 6) / 3;\r\n                        dayLight.intensity = change * dayLightIntensity;\r\n                        nightLight.intensity = (1 - change) * nightLightIntensity;\r\n                    }\r\n                    if (time.hour > 18 && time.hour < 21) {\r\n                        const change = (time.hour - 18) / 3;\r\n                        dayLight.intensity = (1 - change) * dayLightIntensity;\r\n                        nightLight.intensity = change * nightLightIntensity;\r\n                    }\r\n                    //console.log(dayLight.intensity, nightLight.intensity);\r\n\r\n                    //pipeline.setFocusDistance((CAMERA_DISTANCE * this.zoom) / Math.cos(CAMERA_ANGLE));\r\n\r\n                    skybox.position.x = this.me.position.x * 100;\r\n                    skybox.position.y = -this.me.position.y * 100;\r\n                }\r\n\r\n                this.renderDistance = Math.min(Math.ceil(this.zoom * 2), MAX_RENDER_DISTANCE);\r\n            })();\r\n\r\n            if (scene) {\r\n                scene.render();\r\n            }\r\n        });\r\n    }\r\n\r\n    unloadUnusedComponents() {\r\n        if (this.me) {\r\n            this.gameScene.chunks.forEach((chunk) => {\r\n                const distX = Math.abs(Math.round(this.me!.position.x / 16) - chunk.position.x);\r\n                const distY = Math.abs(Math.round(this.me!.position.y / 16) - chunk.position.y);\r\n                if (distX > this.renderDistance || distY > this.renderDistance) {\r\n                    chunk.setVisibility(false);\r\n                    if (distX > DELETE_DISTANCE || distY > DELETE_DISTANCE) {\r\n                        this.gameScene.chunks.remove(chunk.id);\r\n                    }\r\n                } else {\r\n                    chunk.setVisibility(true);\r\n                }\r\n            });\r\n\r\n            this.gameScene.entities.forEach((entity) => {\r\n                const distX = Math.abs(Math.round(this.me!.position.x) - entity.position.x) / 16;\r\n                const distY = Math.abs(Math.round(this.me!.position.y) - entity.position.y) / 16;\r\n\r\n                if (distX > this.renderDistance || distY > this.renderDistance) {\r\n                    entity.setVisibility(false);\r\n                    if (distX > DELETE_DISTANCE || distY > DELETE_DISTANCE) {\r\n                        this.gameScene.entities.remove(entity.id);\r\n                    }\r\n                } else {\r\n                    entity.setVisibilityAttachRenderer(true, this.babylonScene!);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    requestChunks() {\r\n        if (this.me) {\r\n            for (let x = -REQUEST_DISTANCE; x <= REQUEST_DISTANCE; x++) {\r\n                for (let y = -REQUEST_DISTANCE; y <= REQUEST_DISTANCE; y++) {\r\n                    const chunkX = Math.round(this.me.position.x / 16) + x;\r\n                    const chunkY = Math.round(this.me.position.y / 16) + y;\r\n                    const chunkId = Chunk.getId(chunkX, chunkY);\r\n\r\n                    if (!this.gameScene.chunks.includes(chunkId)) {\r\n                        this.networkClient.requestChunk(chunkX, chunkY);\r\n\r\n                        const chunk = new Chunk(this.gameScene, chunkX, chunkY);\r\n                        chunk.attachRenderer(this.babylonScene!);\r\n\r\n                        this.gameScene.chunks.add(chunkId, chunk);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <>\r\n                {!this.state.loggedIn && (\r\n                    <div className=\"center\">\r\n                        <p>Přihlaste se, nebo si vytvořte účet:</p>\r\n                        <p>\r\n                            <input type=\"text\" placeholder=\"Jméno\" ref={this.loginRef} />\r\n                        </p>\r\n                        <p>\r\n                            <input type=\"password\" placeholder=\"Heslo\" ref={this.passwordRef} />\r\n                        </p>\r\n                        <p>\r\n                            <button\r\n                                onClick={() =>\r\n                                    this.networkClient.auth(\r\n                                        this.loginRef!.current!.value,\r\n                                        this.passwordRef!.current!.value,\r\n                                    )\r\n                                }\r\n                            >\r\n                                Přihlásit se!\r\n                            </button>\r\n                        </p>\r\n                    </div>\r\n                )}\r\n                <Engine antialias={true} canvasId=\"game\">\r\n                    <Scene onSceneMount={(event: SceneEventArgs) => this.onSceneMount(event)}>\r\n                        <></>\r\n                    </Scene>\r\n                </Engine>\r\n            </>\r\n        );\r\n    }\r\n}\r\n","import { AdvancedDynamicTexture } from '@babylonjs/gui/2D/advancedDynamicTexture';\r\nimport { GameScene } from '../../../shared/Scene';\r\nimport { Player } from '../../../shared/gameObjects/60_Player';\r\nimport { shadeText } from '../utils/shadeText';\r\nimport { getEntityColor, getTerrainColor } from '../../../shared/colors';\r\n\r\nconst MINIMAP_DISTANCE = 32;\r\nconst MINIMAP_SCALE = 2;\r\nconst BORDER_WIDTH = MINIMAP_SCALE + 1;\r\n\r\nexport function minimap(guiTexture: AdvancedDynamicTexture, gameScene: GameScene, me: Player) {\r\n    const gui = guiTexture.getContext();\r\n    const width = guiTexture.getSize().width;\r\n    //const height = guiTexture.getSize().height;\r\n\r\n    const x0 = width - 30 - MINIMAP_SCALE * MINIMAP_DISTANCE;\r\n    const y0 = 20 + MINIMAP_SCALE * MINIMAP_DISTANCE;\r\n\r\n    const shiftX = Math.floor((Math.floor(me.position.x) - me.position.x) * MINIMAP_SCALE);\r\n    const shiftY = Math.floor((Math.floor(me.position.y) - me.position.y) * MINIMAP_SCALE);\r\n\r\n    gui.fillStyle = '#000000';\r\n    gui.fillRect(\r\n        x0 - MINIMAP_SCALE * MINIMAP_DISTANCE - BORDER_WIDTH,\r\n        y0 - MINIMAP_SCALE * MINIMAP_DISTANCE - BORDER_WIDTH,\r\n        MINIMAP_SCALE * MINIMAP_DISTANCE * 2 + BORDER_WIDTH * 2 + MINIMAP_SCALE,\r\n        MINIMAP_SCALE * MINIMAP_DISTANCE * 2 + BORDER_WIDTH * 2 + MINIMAP_SCALE,\r\n    );\r\n\r\n    for (let x = -MINIMAP_DISTANCE; x <= MINIMAP_DISTANCE + 1; x++) {\r\n        for (let y = -MINIMAP_DISTANCE; y <= MINIMAP_DISTANCE + 1; y++) {\r\n            gui.fillStyle = getTerrainColor(gameScene.getTile(me.position.x + x, me.position.y + y));\r\n            gui.fillRect(\r\n                x0 + x * MINIMAP_SCALE + shiftX,\r\n                y0 + y * MINIMAP_SCALE + shiftY,\r\n                MINIMAP_SCALE,\r\n                MINIMAP_SCALE,\r\n            );\r\n        }\r\n    }\r\n\r\n    gameScene.entities\r\n        .filter(\r\n            (entity) =>\r\n                Math.abs(entity.position.x - me.position.x) <= MINIMAP_DISTANCE + 1.5 &&\r\n                Math.abs(entity.position.y - me.position.y) <= MINIMAP_DISTANCE + 1.5,\r\n        )\r\n        .forEach((entity) => {\r\n            gui.fillStyle = getEntityColor(entity.serialize().type);\r\n            gui.fillRect(\r\n                Math.floor(x0 + (entity.position.x - me.position.x) * MINIMAP_SCALE),\r\n                Math.floor(y0 + (entity.position.y - me.position.y) * MINIMAP_SCALE),\r\n                MINIMAP_SCALE,\r\n                MINIMAP_SCALE,\r\n            );\r\n        });\r\n\r\n    gui.lineWidth = BORDER_WIDTH;\r\n    gui.strokeStyle = '#000000';\r\n    gui.strokeRect(\r\n        x0 - MINIMAP_SCALE * MINIMAP_DISTANCE - BORDER_WIDTH + 2,\r\n        y0 - MINIMAP_SCALE * MINIMAP_DISTANCE - BORDER_WIDTH + 2,\r\n        MINIMAP_SCALE * MINIMAP_DISTANCE * 2 + BORDER_WIDTH * 2 - 4 + MINIMAP_SCALE,\r\n        MINIMAP_SCALE * MINIMAP_DISTANCE * 2 + BORDER_WIDTH * 2 - 4 + MINIMAP_SCALE,\r\n    );\r\n\r\n    gui.font = '16px pixel';\r\n    gui.textBaseline = 'top';\r\n    gui.textAlign = 'center';\r\n    shadeText(gui, 'x', x0, y0 + MINIMAP_SCALE * MINIMAP_DISTANCE + BORDER_WIDTH + 10);\r\n    gui.textAlign = 'right';\r\n    shadeText(\r\n        gui,\r\n        Math.round(me.position.x).toString(),\r\n        x0 - 10,\r\n        y0 + MINIMAP_SCALE * MINIMAP_DISTANCE + BORDER_WIDTH + 10,\r\n    );\r\n    gui.textAlign = 'left';\r\n    shadeText(\r\n        gui,\r\n        Math.round(me.position.y).toString(),\r\n        x0 + 10,\r\n        y0 + MINIMAP_SCALE * MINIMAP_DISTANCE + BORDER_WIDTH + 10,\r\n    );\r\n\r\n    const time = gameScene.getTime();\r\n\r\n    gui.textAlign = 'center';\r\n    shadeText(gui, ':', x0, y0 + MINIMAP_SCALE * MINIMAP_DISTANCE + BORDER_WIDTH + 30);\r\n    gui.textAlign = 'right';\r\n    shadeText(gui, Math.floor(time.hour).toString(), x0 - 5, y0 + MINIMAP_SCALE * MINIMAP_DISTANCE + BORDER_WIDTH + 30);\r\n    gui.textAlign = 'left';\r\n    shadeText(\r\n        gui,\r\n        Math.floor(time.min).toString().padStart(2, '0'),\r\n        x0 + 5,\r\n        y0 + MINIMAP_SCALE * MINIMAP_DISTANCE + BORDER_WIDTH + 30,\r\n    );\r\n    gui.textAlign = 'center';\r\n    shadeText(\r\n        gui,\r\n        '(den ' + Math.floor(time.day).toString() + '.)',\r\n        x0,\r\n        y0 + MINIMAP_SCALE * MINIMAP_DISTANCE + BORDER_WIDTH + 50,\r\n    );\r\n\r\n    guiTexture.update();\r\n}\r\n","import { AdvancedDynamicTexture } from '@babylonjs/gui/2D/advancedDynamicTexture';\r\nimport { GameScene } from '../../../shared/Scene';\r\nimport { shadeText } from '../utils/shadeText';\r\n\r\nexport function debugInfo(guiTexture: AdvancedDynamicTexture, gameScene: GameScene, deltaTime: number) {\r\n    const gui = guiTexture.getContext();\r\n\r\n    let x = 30;\r\n    let y = 20;\r\n\r\n    const values: { [key: string]: string } = {\r\n        FPS: (1000 / deltaTime).toFixed(2),\r\n        'Enabled entities':\r\n            gameScene.entities.filter((value) => value.getVisibility()).length() +\r\n            ' (of ' +\r\n            gameScene.entities.length() +\r\n            ' loaded)',\r\n        'Enabled chunks':\r\n            gameScene.chunks.filter((value) => value.getVisibility()).length() +\r\n            ' (of ' +\r\n            gameScene.chunks.length() +\r\n            ' loaded)',\r\n    };\r\n\r\n    gui.font = '16px pixel';\r\n    gui.textBaseline = 'top';\r\n    gui.textAlign = 'left';\r\n\r\n    Object.keys(values).forEach((key) => {\r\n        shadeText(gui, key + ': ' + values[key], x, y);\r\n        y += 20;\r\n    });\r\n\r\n    guiTexture.update();\r\n}\r\n","import React from 'react';\r\nimport { GameCore } from './gameMechanics/GameCore';\r\nimport { loadTextures } from '../shared/gameObjects/renderers/textures/textureEngine';\r\n\r\ninterface IAppProps {}\r\n\r\ninterface IAppState {\r\n    status: 'loading' | 'ingame';\r\n    textures: {\r\n        loaded: number;\r\n        of: number;\r\n    };\r\n}\r\n\r\nclass App extends React.Component<IAppProps, IAppState> {\r\n    apiUrl = 'https://randombot-server.herokuapp.com/';\r\n\r\n    state: IAppState = {\r\n        status: 'loading',\r\n        textures: {\r\n            loaded: 0,\r\n            of: 0,\r\n        },\r\n    };\r\n\r\n    constructor(props: IAppProps) {\r\n        super(props);\r\n\r\n        if (window.location.host.includes('localhost')) {\r\n            this.apiUrl = 'http://localhost:80/';\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.setState({\r\n            textures: {\r\n                loaded: 0,\r\n                of: loadTextures(\r\n                    () => {\r\n                        this.setState({ status: 'ingame' });\r\n                    },\r\n                    (loaded, of) => {\r\n                        this.setState({\r\n                            textures: {\r\n                                loaded,\r\n                                of,\r\n                            },\r\n                        });\r\n                    },\r\n                ),\r\n            },\r\n        });\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <>\r\n                {this.state.status === 'loading' && (\r\n                    <div className=\"center\">\r\n                        Načítání textur... ({this.state.textures.loaded}/{this.state.textures.of})\r\n                    </div>\r\n                )}\r\n                {this.state.status === 'ingame' && <GameCore apiUrl={this.apiUrl} />}\r\n            </>\r\n        );\r\n    }\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n    window.location.hostname === 'localhost' ||\r\n        // [::1] is the IPv6 localhost address.\r\n        window.location.hostname === '[::1]' ||\r\n        // 127.0.0.0/8 are considered localhost for IPv4.\r\n        window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/),\r\n);\r\n\r\nexport function register(config) {\r\n    if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n        // The URL constructor is available in all browsers that support SW.\r\n        const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n        if (publicUrl.origin !== window.location.origin) {\r\n            // Our service worker won't work if PUBLIC_URL is on a different origin\r\n            // from what our page is served on. This might happen if a CDN is used to\r\n            // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n            return;\r\n        }\r\n\r\n        window.addEventListener('load', () => {\r\n            const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n            if (isLocalhost) {\r\n                // This is running on localhost. Let's check if a service worker still exists or not.\r\n                checkValidServiceWorker(swUrl, config);\r\n\r\n                // Add some additional logging to localhost, pointing developers to the\r\n                // service worker/PWA documentation.\r\n                navigator.serviceWorker.ready.then(() => {\r\n                    console.log(\r\n                        'This web app is being served cache-first by a service ' +\r\n                            'worker. To learn more, visit https://bit.ly/CRA-PWA',\r\n                    );\r\n                });\r\n            } else {\r\n                // Is not localhost. Just register service worker\r\n                registerValidSW(swUrl, config);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n    navigator.serviceWorker\r\n        .register(swUrl)\r\n        .then((registration) => {\r\n            registration.onupdatefound = () => {\r\n                const installingWorker = registration.installing;\r\n                if (installingWorker == null) {\r\n                    return;\r\n                }\r\n                installingWorker.onstatechange = () => {\r\n                    if (installingWorker.state === 'installed') {\r\n                        if (navigator.serviceWorker.controller) {\r\n                            // At this point, the updated precached content has been fetched,\r\n                            // but the previous service worker will still serve the older\r\n                            // content until all client tabs are closed.\r\n                            console.log(\r\n                                'New content is available and will be used when all ' +\r\n                                    'tabs for this page are closed. See https://bit.ly/CRA-PWA.',\r\n                            );\r\n\r\n                            // Execute callback\r\n                            if (config && config.onUpdate) {\r\n                                config.onUpdate(registration);\r\n                            }\r\n                        } else {\r\n                            // At this point, everything has been precached.\r\n                            // It's the perfect time to display a\r\n                            // \"Content is cached for offline use.\" message.\r\n                            console.log('Content is cached for offline use.');\r\n\r\n                            // Execute callback\r\n                            if (config && config.onSuccess) {\r\n                                config.onSuccess(registration);\r\n                            }\r\n                        }\r\n                    }\r\n                };\r\n            };\r\n        })\r\n        .catch((error) => {\r\n            console.error('Error during service worker registration:', error);\r\n        });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n    // Check if the service worker can be found. If it can't reload the page.\r\n    fetch(swUrl, {\r\n        headers: { 'Service-Worker': 'script' },\r\n    })\r\n        .then((response) => {\r\n            // Ensure service worker exists, and that we really are getting a JS file.\r\n            const contentType = response.headers.get('content-type');\r\n            if (response.status === 404 || (contentType != null && contentType.indexOf('javascript') === -1)) {\r\n                // No service worker found. Probably a different app. Reload the page.\r\n                navigator.serviceWorker.ready.then((registration) => {\r\n                    registration.unregister().then(() => {\r\n                        window.location.reload();\r\n                    });\r\n                });\r\n            } else {\r\n                // Service worker found. Proceed as normal.\r\n                registerValidSW(swUrl, config);\r\n            }\r\n        })\r\n        .catch(() => {\r\n            console.log('No internet connection found. App is running in offline mode.');\r\n        });\r\n}\r\n\r\nexport function unregister() {\r\n    if ('serviceWorker' in navigator) {\r\n        navigator.serviceWorker.ready\r\n            .then((registration) => {\r\n                registration.unregister();\r\n            })\r\n            .catch((error) => {\r\n                console.error(error.message);\r\n            });\r\n    }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './frontend/index.css';\r\nimport App from './frontend/App';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(\r\n    <React.StrictMode>\r\n        <App />\r\n    </React.StrictMode>,\r\n    document.getElementById('root'),\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}