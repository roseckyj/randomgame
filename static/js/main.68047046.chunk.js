(this.webpackJsonprandomgame=this.webpackJsonprandomgame||[]).push([[0],{405:function(e,t,i){e.exports=i(444)},409:function(e,t,i){},441:function(e,t){},444:function(e,t,i){"use strict";i.r(t);var n=i(38),s=i.n(n),a=i(402),o=i.n(a),r=(i(409),i(104)),c=i(105),h=i(139),u=i(166),l=(i(343),i(37)),d=i(367),y=i(158),f=i(229),g=i.n(f),v=i(340),p=i(368),k=i(341),m=i(121),b={grass_01:{filename:"HiddenThroughTime/buildings/Atlas_Egypt_Props_01.png",corner:new l.t(365,1875),size:new l.t(85,40)},grass_02:{filename:"HiddenThroughTime/buildings/Atlas_Egypt_Props_01.png",corner:new l.t(365,1930),size:new l.t(85,40)},grass_03:{filename:"HiddenThroughTime/buildings/Atlas_Egypt_Props_01.png",corner:new l.t(365,1990),size:new l.t(85,40)},player:{filename:"HiddenThroughTime/characters/Icon_Peasant_Man_9.png",corner:new l.t(0,0),size:new l.t(79,147)}},w=Object.values(b).map((function(e){return e.filename}));w=w.filter((function(e,t){return w.indexOf(e)===t}));var x={},S=0;function O(e,t){var i=new l.q("mat",t);return i.emissiveTexture=e,i.opacityTexture=e,i}var E=function(){function e(){Object(r.a)(this,e),this.scene=null,this.mesh=null,this.position=l.t.Zero()}return Object(c.a)(e,[{key:"attachBabylon",value:function(e){return this.scene=e,this}},{key:"tick",value:function(e){}},{key:"setVisibility",value:function(e){this.mesh&&this.mesh.setEnabled(e)}}]),e}(),j=function(e){Object(h.a)(i,e);var t=Object(u.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this)).id=e,n.velocityX=0,n.velocityY=0,n.targetX=0,n.targetY=0,n.finalVelocityX=0,n.finalVelocityY=0,n.targetTime=-1,n.keyBindings={up:0,down:0,left:0,right:0},n.keysPressed=[],n}return Object(c.a)(i,[{key:"serialize",value:function(){return{x:this.position.x,y:this.position.y,velocityX:this.velocityX,velocityY:this.velocityY}}},{key:"deserialize",value:function(e,t){t?(this.targetX=e.x,this.targetY=e.y,this.finalVelocityX=e.velocityX,this.finalVelocityY=e.velocityY,this.targetTime=50,this.velocityX=(e.x-this.position.x)/50,this.velocityY=(e.y-this.position.y)/50):(this.position.x=e.x,this.position.y=e.y,this.velocityX=e.velocityX,this.velocityY=e.velocityY)}},{key:"tick",value:function(e){if(this.targetTime>0)return this.position.x+=this.velocityX*e,this.position.y+=this.velocityY*e,this.targetTime-=e,this.targetTime<=0&&(this.position.x=this.targetX,this.position.y=this.targetY,this.velocityX=this.finalVelocityX,this.velocityY=this.finalVelocityY),void this.updateMesh();if(!this.keyBindings.up&&!this.keyBindings.down&&!this.keyBindings.left&&!this.keyBindings.right)return this.position.x+=this.velocityX,this.position.y+=this.velocityY,void this.updateMesh();var t=.1*e,i=!1,n=!1,s=Math.sqrt(2);(this.keysPressed.includes(this.keyBindings.left)||this.keysPressed.includes(this.keyBindings.right))&&(i=!0),(this.keysPressed.includes(this.keyBindings.up)||this.keysPressed.includes(this.keyBindings.down))&&(n=!0),this.keysPressed.includes(this.keyBindings.left)&&(this.velocityX-=.2*t/(n?s:1)),this.keysPressed.includes(this.keyBindings.right)&&(this.velocityX+=.2*t/(n?s:1)),this.keysPressed.includes(this.keyBindings.up)&&(this.velocityY-=.2*t/(i?s:1)),this.keysPressed.includes(this.keyBindings.down)&&(this.velocityY+=.2*t/(i?s:1)),this.position.x+=this.velocityX*t,this.position.y+=this.velocityY*t,this.velocityX*=Math.pow(.95,t),this.velocityY*=Math.pow(.95,t),Math.abs(this.velocityX)<.1&&(this.velocityX=0),Math.abs(this.velocityY)<.1&&(this.velocityY=0),this.updateMesh()}},{key:"keyDown",value:function(e){this.keysPressed.includes(e)||this.keysPressed.push(e)}},{key:"keyUp",value:function(e){this.keysPressed.includes(e)&&(this.keysPressed=this.keysPressed.filter((function(t){return t!==e})))}},{key:"bindKeys",value:function(e){this.keyBindings=Object(p.a)(Object(p.a)({},this.keyBindings),e)}},{key:"attachBabylon",value:function(e){if(Object(k.a)(Object(m.a)(i.prototype),"attachBabylon",this).call(this,e),!this.scene)return this;this.mesh=l.j.CreatePlane("player",{width:60,height:100,sideOrientation:l.i.FRONTSIDE},this.scene);var t=function(e,t){var i=new l.r("resources/"+b[e].filename,t,!1,!0,l.r.NEAREST_LINEAR);return i.hasAlpha=!0,i}("player",this.scene);this.mesh.material=O(t,this.scene);var n=l.j.CreatePlane("title",{width:100,height:20,sideOrientation:l.i.FRONTSIDE},this.scene);n.position=new l.u(0,60,-3);var s=new l.f("titleTexture",{width:100,height:20},this.scene,!0,l.r.NEAREST_LINEAR),a=s.getContext();return a.fillStyle="#000000AA",a.fillRect(0,0,s.getSize().width,s.getSize().height),a.font="15px Arial",a.textBaseline="middle",a.textAlign="center",a.fillStyle="#FFFFFF",a.fillText(this.id,s.getSize().width/2,s.getSize().height/2,s.getSize().width-20),s.update(),n.parent=this.mesh,n.material=O(s,this.scene),this.updateMesh(),this}},{key:"updateMesh",value:function(){var e=Object(v.a)(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.mesh&&(this.mesh.position=new l.u(this.position.x,-this.position.y,-1));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),i}(E),T=function(e){Object(h.a)(i,e);var t=Object(u.a)(i);function i(e,n){var s;return Object(r.a)(this,i),(s=t.call(this)).ground=[[]],s.position=new l.t(e,n),s}return Object(c.a)(i,[{key:"serialize",value:function(){return{x:this.position.x,y:this.position.y,ground:this.ground}}},{key:"deserialize",value:function(e){this.position.x=e.x,this.position.y=e.y,this.ground=e.ground,this.updateMesh()}},{key:"attachBabylon",value:function(e){return Object(k.a)(Object(m.a)(i.prototype),"attachBabylon",this).call(this,e),this.mesh=l.j.CreatePlane("chunk",{width:1600,height:1600,sideOrientation:l.i.FRONTSIDE},this.scene),this.updateMesh(),this}},{key:"updateMesh",value:function(){var e=Object(v.a)(g.a.mark((function e(){var t,n,s,a,o;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mesh&&this.scene){e.next=2;break}return e.abrupt("return");case 2:for(this.mesh.position=new l.u(16*this.position.x*100,16*-this.position.y*100,0),t=new l.f("chunkTexture",{width:16,height:16},this.scene,!0,l.r.NEAREST_NEAREST),n=t.getContext(),s=0;s<16;s++)for(a=0;a<16;a++)this.ground[s]&&this.ground[s][a]&&(n.fillStyle=i.getTerrainColor(this.ground[s][a]),n.fillRect(s,a,1,1),(s+a)%2===0&&(n.fillStyle="#00000005",n.fillRect(s,a,1,1)));t.update(),(o=new l.q("mat",this.scene)).emissiveTexture=t,this.mesh.material=o;case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"id",get:function(){return i.getId(this.position.x,this.position.y)}}],[{key:"getId",value:function(e,t){return e.toString()+"x"+t.toString()}},{key:"getTerrainColor",value:function(e){switch(e){case 1:return"#CFDA78";case 2:return"#4EDCF0";case 3:return"#6AA981";case 4:return"#FDDC86"}return"#DDDDDD"}}]),i}(E),B=function(){function e(){Object(r.a)(this,e),this.players=new C,this.chunks=new C}return Object(c.a)(e,[{key:"tickAll",value:function(e){this.players.forEach((function(t){return t.tick(e)})),this.chunks.forEach((function(t){return t.tick(e)}))}}]),e}(),C=function(){function e(){Object(r.a)(this,e),this.values={}}return Object(c.a)(e,[{key:"add",value:function(e,t){this.values[e]=t}},{key:"remove",value:function(e){this.includes(e)&&delete this.values[e]}},{key:"update",value:function(e,t,i){this.values[e].deserialize(t,i)}},{key:"updateOrCreate",value:function(e,t,i,n){this.includes(e)||(this.values[e]=i()),this.values[e].deserialize(t,n)}},{key:"get",value:function(e){return this.includes(e)?this.values[e]:null}},{key:"includes",value:function(e){return Object.keys(this.values).includes(e)}},{key:"forEach",value:function(e){var t=this;Object.keys(this.values).forEach((function(i,n){e(t.values[i],i,n)}))}},{key:"filter",value:function(e){var t=this,i=Object.keys(this.values),n=Object.assign({},this.values);return i.forEach((function(i,s){e(t.values[i],i,s)||delete n[i]})),n}}]),e}(),M={left:65,right:68,up:87,down:83},z=i(404),I=i.n(z),P=function(){function e(t,i,n){Object(r.a)(this,e),this.apiUrl=t,this.scene=i,this.getBabylonScene=n,this.socket=void 0,this.userId=void 0,this.opened=void 0,this.callbacks={authenticated:function(){},updated:function(){}}}return Object(c.a)(e,[{key:"on",value:function(e,t){this.callbacks[e]=t}},{key:"close",value:function(){this.socket.disconnect()}},{key:"open",value:function(){var e=this;this.opened=!0,this.socket=I()(this.apiUrl),this.setListeners(),this.socket.on("id",(function(t){e.userId=t,e.callbacks.authenticated({id:t}),console.log("Joined game with player ID: ",t)}))}},{key:"sendPlayerUpdate",value:function(e){this.socket.emit("update",{id:e.id,content:e.serialize()})}},{key:"requestChunk",value:function(e,t){this.socket.emit("mapRequest",{x:e,y:t})}},{key:"setListeners",value:function(){var e=this;this.socket.on("players",(function(t){e.scene.players.forEach((function(i,n){Object.keys(t).includes(n)?e.scene.players.get(n).setVisibility(!0):e.scene.players.get(n).setVisibility(!1)})),Object.keys(t).forEach((function(i){i!==e.userId&&e.scene.players.updateOrCreate(i,t[i],(function(){return new j(i).attachBabylon(e.getBabylonScene())}))}))})),this.socket.on("mapChunk",(function(t){var i=T.getId(t.x,t.y);e.scene.chunks.updateOrCreate(i,t,(function(){return new T(t.x,t.y).attachBabylon(e.getBabylonScene())}))}))}}]),e}();function A(e,t,i){var n=Math.floor(e)+8,s=Math.floor(t)+8,a=Math.floor(n/16),o=Math.floor(s/16),r=i.chunks.get(T.getId(a,o));return r&&r.ground[n-16*a]&&r.ground[n-16*a][s-16*o]?r.ground[n-16*a][s-16*o]:-1}var X=function(e){Object(h.a)(i,e);var t=Object(u.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e)).gameScene=void 0,n.me=null,n.babylonScene=void 0,n.guiTexture=void 0,n.networkClient=void 0,n.state={},n.timer=void 0,n.gameScene=new B,n.networkClient=new P(n.props.apiUrl,n.gameScene,(function(){return n.babylonScene})),n.networkClient.on("authenticated",(function(e){return n.initGame(e.id)})),document.addEventListener("keydown",(function(e){n.me&&n.me.keyDown(e.keyCode)})),document.addEventListener("keyup",(function(e){n.me&&n.me.keyUp(e.keyCode)})),window.addEventListener("resize",(function(e){n.resize()})),n}return Object(c.a)(i,[{key:"componentDidMount",value:function(){this.resize(),this.networkClient.open()}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer),this.networkClient.close()}},{key:"initGame",value:function(e){var t=this;this.me=new j(e),this.me.attachBabylon(this.babylonScene),this.me.bindKeys(M),this.gameScene.players.add(e,this.me),window.player=this.me,window.scene=this.gameScene,this.timer=setInterval((function(){t.me&&t.networkClient.sendPlayerUpdate(t.me)}),100)}},{key:"tick",value:function(e){if(this.gameScene.players.forEach((function(t){return t.tick(e)})),this.gameScene.chunks.forEach((function(e){return e.setVisibility(!1)})),this.me&&this.guiTexture){for(var t=-2;t<=2;t++)for(var i=-2;i<=2;i++){var n=Math.round(this.me.position.x/1600)+t,s=Math.round(this.me.position.y/1600)+i,a=T.getId(n,s);this.gameScene.chunks.includes(a)?this.gameScene.chunks.get(a).setVisibility(!0):(this.networkClient.requestChunk(n,s),this.gameScene.chunks.add(a,new T(n,s).attachBabylon(this.babylonScene)))}var o=this.guiTexture.getContext(),r=this.guiTexture.getSize().width,c=this.guiTexture.getSize().height;o.clearRect(0,0,r,c),function(e,t,i){var n=e.getContext(),s=e.getSize().width,a=(e.getSize().height,s-30-64);n.fillStyle="#000000",n.fillRect(a-64-3,17,136,136);for(var o=-32;o<=32;o++)for(var r=-32;r<=32;r++)n.fillStyle=T.getTerrainColor(A(i.position.x/100+o,i.position.y/100+r,t)),n.fillRect(a+2*o,84+2*r,2,2);n.fillStyle="#000000",n.font="15px Arial",n.textBaseline="top",n.textAlign="center",n.fillText(i?Math.round(i.position.x/100)+" \xd7 "+Math.round(i.position.y/100):"Not connected...",a,161),n.fillStyle="#00000020",n.fillRect(a-6,84,14,2),n.fillRect(a,78,2,14),e.update()}(this.guiTexture,this.gameScene,this.me),this.guiTexture.update()}}},{key:"resize",value:function(){var e=document.getElementById("game");e&&(e.width=window.innerWidth,e.height=window.innerHeight)}},{key:"onSceneMount",value:function(e){var t=this,i=e.scene;this.babylonScene=i;var n=new l.s("Camera",new l.u(0,0,1500),i);n.rotation=new l.u(0,0,0),this.guiTexture=y.a.CreateFullscreenUI("GUI",!0,i),i.getEngine().runRenderLoop((function(){t.tick(i.getEngine().getDeltaTime()),t.me&&(n.position=new l.u(t.me.position.x,-t.me.position.y,-1500)),i&&i.render()}))}},{key:"render",value:function(){var e=this;return s.a.createElement(s.a.Fragment,null,s.a.createElement(d.a,{antialias:!0,canvasId:"game"},s.a.createElement(d.b,{onSceneMount:function(t){return e.onSceneMount(t)}},s.a.createElement(s.a.Fragment,null))))}}]),i}(s.a.Component),Y=function(e){Object(h.a)(i,e);var t=Object(u.a)(i);function i(){var e;Object(r.a)(this,i);for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return(e=t.call.apply(t,[this].concat(s))).apiUrl="https://randombot-server.herokuapp.com/",e.state={status:"loading",textures:{loaded:0,of:0}},e}return Object(c.a)(i,[{key:"componentDidMount",value:function(){var e,t,i=this;this.setState({textures:{loaded:0,of:(e=function(){i.setState({status:"ingame"})},t=function(e,t){i.setState({textures:{loaded:e,of:t}})},w.forEach((function(i){x[i]=new Image,x[i].onload=function(){S++,t&&t(S,w.length),S===w.length&&e()},x[i].onerror=function(){console.error("Error loading resource file: ",i)},x[i].src="resources/"+i})),w.length)}})}},{key:"render",value:function(){return s.a.createElement(s.a.Fragment,null,"loading"===this.state.status&&s.a.createElement("div",{style:{textAlign:"center"}},"Textures are loading (",this.state.textures.loaded,"/",this.state.textures.of,")"),"ingame"===this.state.status&&s.a.createElement(X,{apiUrl:this.apiUrl}))}}]),i}(s.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(Y,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[405,1,2]]]);
//# sourceMappingURL=main.68047046.chunk.js.map